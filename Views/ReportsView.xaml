<UserControl x:Class="DOInventoryManager.Views.ReportsView"
             xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
             xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
             xmlns:sys="clr-namespace:System;assembly=mscorlib">

    <ScrollViewer VerticalScrollBarVisibility="Auto">
        <Grid Margin="20">
            <Grid.RowDefinitions>
                <RowDefinition Height="Auto"/>
                <!-- Header -->
                <RowDefinition Height="*"/>
                <!-- Content -->
            </Grid.RowDefinitions>

            <!-- Header -->
            <StackPanel Grid.Row="0" Orientation="Horizontal" Margin="0,0,0,20">
                <TextBlock Text="📈" FontSize="32" VerticalAlignment="Center" Margin="0,0,10,0"/>
                <TextBlock Text="Reports &amp; Analytics" FontSize="28" FontWeight="Bold" 
                         VerticalAlignment="Center" Foreground="#2c3e50"/>
            </StackPanel>

            <!-- Reports Tabs -->
            <TabControl Grid.Row="1" x:Name="ReportsTabControl">

                <!-- Monthly Summary Tab -->
                <TabItem Header="📊 Monthly Summary">
                    <ScrollViewer VerticalScrollBarVisibility="Auto">
                        <Grid Margin="20">
                            <Grid.RowDefinitions>
                                <RowDefinition Height="Auto"/>
                                <!-- Controls -->
                                <RowDefinition Height="*"/>
                                <!-- Content -->
                            </Grid.RowDefinitions>

                            <!-- Controls -->
                            <Border Grid.Row="0" Background="#f8f9fa" BorderBrush="#dee2e6" BorderThickness="1" 
                                  CornerRadius="8" Padding="20" Margin="0,0,0,20">
                                <Grid>
                                    <Grid.ColumnDefinitions>
                                        <ColumnDefinition Width="*"/>
                                        <ColumnDefinition Width="Auto"/>
                                    </Grid.ColumnDefinitions>

                                    <StackPanel Grid.Column="0" Orientation="Horizontal">
                                        <TextBlock Text="Select Month:" FontWeight="SemiBold" VerticalAlignment="Center" Margin="0,0,10,0"/>
                                        <ComboBox x:Name="MonthComboBox" MinWidth="120" Padding="10,8" 
                                                SelectionChanged="MonthComboBox_SelectionChanged"/>
                                        <Button x:Name="GenerateBtn" Content="📊 Generate Report" 
                                              Background="#007bff" Foreground="White" BorderThickness="0" 
                                              Padding="15,10" Margin="15,0,0,0" FontWeight="SemiBold"
                                              Click="Generate_Click"/>
                                    </StackPanel>

                                    <StackPanel Grid.Column="1" Orientation="Horizontal">
                                        <Button x:Name="ExportBtn" Content="📤 Export to Excel" 
                                              Background="#28a745" Foreground="White" BorderThickness="0" 
                                              Padding="15,10" Margin="0,0,10,0" FontWeight="SemiBold"
                                              Click="Export_Click"/>
                                        <Button x:Name="PrintBtn" Content="🖨️ Print Report" 
                                              Background="#6c757d" Foreground="White" BorderThickness="0" 
                                              Padding="15,10" FontWeight="SemiBold"
                                              Click="Print_Click"/>
                                    </StackPanel>
                                </Grid>
                            </Border>

                            <!-- Summary Content (will be populated from existing SummaryView) -->
                            <TabControl Grid.Row="1" x:Name="SummaryTabControl">
                                <!-- Executive Summary -->
                                <TabItem Header="📊 Executive Summary">
                                    <ScrollViewer VerticalScrollBarVisibility="Auto">
                                        <StackPanel Margin="20">
                                            <!-- KPI Cards -->
                                            <Grid Margin="0,0,0,30">
                                                <Grid.ColumnDefinitions>
                                                    <ColumnDefinition Width="*"/>
                                                    <ColumnDefinition Width="*"/>
                                                    <ColumnDefinition Width="*"/>
                                                    <ColumnDefinition Width="*"/>
                                                </Grid.ColumnDefinitions>

                                                <Border Grid.Column="0" Background="#007bff" CornerRadius="8" Margin="0,0,15,0" Padding="20">
                                                    <StackPanel>
                                                        <TextBlock Text="⛽" FontSize="24" HorizontalAlignment="Center" Foreground="White"/>
                                                        <TextBlock x:Name="TotalConsumptionText" Text="0 L" FontSize="18" FontWeight="Bold" 
                                                                 HorizontalAlignment="Center" Foreground="White" Margin="0,5,0,3"/>
                                                        <TextBlock Text="Total Consumption" FontSize="11" HorizontalAlignment="Center" 
                                                                 Foreground="LightBlue"/>
                                                    </StackPanel>
                                                </Border>

                                                <Border Grid.Column="1" Background="#28a745" CornerRadius="8" Margin="0,0,15,0" Padding="20">
                                                    <StackPanel>
                                                        <TextBlock Text="🗺️" FontSize="24" HorizontalAlignment="Center" Foreground="White"/>
                                                        <TextBlock x:Name="TotalLegsText" Text="0" FontSize="18" FontWeight="Bold" 
                                                                 HorizontalAlignment="Center" Foreground="White" Margin="0,5,0,3"/>
                                                        <TextBlock Text="Legs Completed" FontSize="11" HorizontalAlignment="Center" 
                                                                 Foreground="LightGreen"/>
                                                    </StackPanel>
                                                </Border>

                                                <Border Grid.Column="2" Background="#dc3545" CornerRadius="8" Margin="0,0,15,0" Padding="20">
                                                    <StackPanel>
                                                        <TextBlock Text="💰" FontSize="24" HorizontalAlignment="Center" Foreground="White"/>
                                                        <TextBlock x:Name="TotalCostText" Text="$0" FontSize="18" FontWeight="Bold" 
                                                                 HorizontalAlignment="Center" Foreground="White" Margin="0,5,0,3"/>
                                                        <TextBlock Text="Operating Cost" FontSize="11" HorizontalAlignment="Center" 
                                                                 Foreground="LightPink"/>
                                                    </StackPanel>
                                                </Border>

                                                <Border Grid.Column="3" Background="#ffc107" CornerRadius="8" Padding="20">
                                                    <StackPanel>
                                                        <TextBlock Text="📈" FontSize="24" HorizontalAlignment="Center" Foreground="White"/>
                                                        <TextBlock x:Name="EfficiencyText" Text="0 L/leg" FontSize="18" FontWeight="Bold" 
                                                                 HorizontalAlignment="Center" Foreground="White" Margin="0,5,0,3"/>
                                                        <TextBlock Text="Fleet Efficiency" FontSize="11" HorizontalAlignment="Center" 
                                                                 Foreground="#856404"/>
                                                    </StackPanel>
                                                </Border>
                                            </Grid>

                                            <!-- Executive Metrics -->
                                            <Border Background="White" BorderBrush="#dee2e6" BorderThickness="1" 
                                                  CornerRadius="6" Padding="20">
                                                <StackPanel>
                                                    <TextBlock Text="📋 Executive Metrics" FontSize="16" FontWeight="SemiBold" 
                                                             Margin="0,0,0,15" Foreground="#2c3e50"/>

                                                    <Grid>
                                                        <Grid.ColumnDefinitions>
                                                            <ColumnDefinition Width="*"/>
                                                            <ColumnDefinition Width="*"/>
                                                        </Grid.ColumnDefinitions>

                                                        <StackPanel Grid.Column="0">
                                                            <TextBlock x:Name="VesselsOperatedText" Text="Vessels Operated: 0" FontSize="14" Margin="0,5"/>
                                                            <TextBlock x:Name="SuppliersUsedText" Text="Suppliers Used: 0" FontSize="14" Margin="0,5"/>
                                                            <TextBlock x:Name="CostPerLegText" Text="Cost per Leg: $0.00" FontSize="14" Margin="0,5"/>
                                                        </StackPanel>

                                                        <StackPanel Grid.Column="1">
                                                            <TextBlock x:Name="FleetEfficiencyLText" Text="Fleet Efficiency (L): 0.000 L/leg" FontSize="14" Margin="0,5"/>
                                                            <TextBlock x:Name="FleetEfficiencyTText" Text="Fleet Efficiency (T): 0.000 T/leg" FontSize="14" Margin="0,5"/>
                                                            <TextBlock x:Name="InventoryTurnoverText" Text="Inventory Turnover: 0.00" FontSize="14" Margin="0,5"/>
                                                        </StackPanel>
                                                    </Grid>
                                                </StackPanel>
                                            </Border>
                                        </StackPanel>
                                    </ScrollViewer>
                                </TabItem>

                                <!-- Consumption Summary Tab -->
                                <TabItem Header="⛽ Consumption Summary">
                                    <StackPanel Margin="20">
                                        <TextBlock Text="Vessel Consumption Analysis" FontSize="16" FontWeight="SemiBold" 
                                                Margin="0,0,0,15" Foreground="#2c3e50"/>

                                        <DataGrid x:Name="ConsumptionSummaryGrid" 
                                                AutoGenerateColumns="False" 
                                                CanUserAddRows="False"
                                                CanUserDeleteRows="False"
                                                GridLinesVisibility="Horizontal"
                                                HeadersVisibility="Column"
                                                Background="White"
                                                BorderThickness="1"
                                                BorderBrush="#dee2e6">

                                            <DataGrid.Columns>
                                                <DataGridTextColumn Header="Vessel" Binding="{Binding VesselName}" Width="120"/>
                                                <DataGridTextColumn Header="Type" Binding="{Binding VesselType}" Width="80"/>
                                                <DataGridTextColumn Header="Route" Binding="{Binding Route}" Width="180"/>
                                                <DataGridTextColumn Header="Consumption (L)" Binding="{Binding TotalConsumptionL, StringFormat=N3}" Width="120"/>
                                                <DataGridTextColumn Header="Consumption (T)" Binding="{Binding TotalConsumptionT, StringFormat=N3}" Width="120"/>
                                                <DataGridTextColumn Header="Total Legs" Binding="{Binding TotalLegs}" Width="80"/>
                                                <DataGridTextColumn Header="L/Leg" Binding="{Binding AvgConsumptionPerLegL, StringFormat=N3}" Width="80"/>
                                                <DataGridTextColumn Header="T/Leg" Binding="{Binding AvgConsumptionPerLegT, StringFormat=N3}" Width="80"/>
                                                <DataGridTextColumn Header="Total Cost" Binding="{Binding TotalAllocatedValueUSD, StringFormat=C2}" Width="100"/>
                                                <DataGridTextColumn Header="Cost/L" Binding="{Binding CostPerLiter, StringFormat=C6}" Width="100"/>
                                                <DataGridTextColumn Header="Cost/T" Binding="{Binding CostPerTon, StringFormat=C2}" Width="100"/>
                                                <DataGridTextColumn Header="Entries" Binding="{Binding ConsumptionEntries}" Width="70"/>
                                            </DataGrid.Columns>
                                        </DataGrid>
                                    </StackPanel>
                                </TabItem>

                                <!-- Purchase Summary Tab -->
                                <TabItem Header="🛒 Purchase Summary">
                                    <StackPanel Margin="20">
                                        <TextBlock Text="Supplier Purchase Analysis" FontSize="16" FontWeight="SemiBold" 
                                                Margin="0,0,0,15" Foreground="#2c3e50"/>

                                        <DataGrid x:Name="PurchaseSummaryGrid" 
                                                AutoGenerateColumns="False" 
                                                CanUserAddRows="False"
                                                CanUserDeleteRows="False"
                                                GridLinesVisibility="Horizontal"
                                                HeadersVisibility="Column"
                                                Background="White"
                                                BorderThickness="1"
                                                BorderBrush="#dee2e6">

                                            <DataGrid.Columns>
                                                <DataGridTextColumn Header="Supplier" Binding="{Binding SupplierName}" Width="120"/>
                                                <DataGridTextColumn Header="Currency" Binding="{Binding Currency}" Width="80"/>
                                                <DataGridTextColumn Header="Purchases (L)" Binding="{Binding TotalPurchasesL, StringFormat=N3}" Width="110"/>
                                                <DataGridTextColumn Header="Purchases (T)" Binding="{Binding TotalPurchasesT, StringFormat=N3}" Width="110"/>
                                                <DataGridTextColumn Header="Total Value" Width="120">
                                                    <DataGridTextColumn.Binding>
                                                        <MultiBinding StringFormat="{}{0:N3} {1}">
                                                            <Binding Path="TotalValueOriginal"/>
                                                            <Binding Path="Currency"/>
                                                        </MultiBinding>
                                                    </DataGridTextColumn.Binding>
                                                </DataGridTextColumn>
                                                <DataGridTextColumn Header="USD Value" Binding="{Binding TotalValueUSD, StringFormat=C2}" Width="100"/>
                                                <DataGridTextColumn Header="Avg Price/L" Width="100">
                                                    <DataGridTextColumn.Binding>
                                                        <MultiBinding StringFormat="{}{0:N6} {1}">
                                                            <Binding Path="AvgPricePerLiter"/>
                                                            <Binding Path="Currency"/>
                                                        </MultiBinding>
                                                    </DataGridTextColumn.Binding>
                                                </DataGridTextColumn>
                                                <DataGridTextColumn Header="Remaining (L)" Binding="{Binding RemainingL, StringFormat=N3}" Width="100"/>
                                                <DataGridTextColumn Header="Remaining (T)" Binding="{Binding RemainingT, StringFormat=N3}" Width="100"/>
                                                <DataGridTextColumn Header="Orders" Binding="{Binding PurchaseCount}" Width="70"/>
                                            </DataGrid.Columns>
                                        </DataGrid>
                                    </StackPanel>
                                </TabItem>

                                <!-- Allocation Summary Tab -->
                                <TabItem Header="📋 FIFO Allocation">
                                    <StackPanel Margin="20">
                                        <TextBlock Text="FIFO Allocation Analysis" FontSize="16" FontWeight="SemiBold" 
                                                Margin="0,0,0,15" Foreground="#2c3e50"/>

                                        <DataGrid x:Name="AllocationSummaryGrid" 
                                                AutoGenerateColumns="False" 
                                                CanUserAddRows="False"
                                                CanUserDeleteRows="False"
                                                GridLinesVisibility="Horizontal"
                                                HeadersVisibility="Column"
                                                Background="White"
                                                BorderThickness="1"
                                                BorderBrush="#dee2e6">

                                            <DataGrid.Columns>
                                                <DataGridTextColumn Header="Vessel" Binding="{Binding VesselName}" Width="120"/>
                                                <DataGridTextColumn Header="Supplier" Binding="{Binding SupplierName}" Width="120"/>
                                                <DataGridTextColumn Header="Allocated (L)" Binding="{Binding AllocatedQuantityL, StringFormat=N3}" Width="110"/>
                                                <DataGridTextColumn Header="Allocated (T)" Binding="{Binding AllocatedQuantityT, StringFormat=N3}" Width="110"/>
                                                <DataGridTextColumn Header="USD Value" Binding="{Binding AllocatedValueUSD, StringFormat=C2}" Width="100"/>
                                                <DataGridTextColumn Header="Allocations" Binding="{Binding AllocationCount}" Width="90"/>
                                                <DataGridTextColumn Header="From Date" Binding="{Binding OldestPurchaseDate, StringFormat=dd/MM/yyyy}" Width="100"/>
                                                <DataGridTextColumn Header="To Date" Binding="{Binding NewestPurchaseDate, StringFormat=dd/MM/yyyy}" Width="100"/>
                                            </DataGrid.Columns>
                                        </DataGrid>
                                    </StackPanel>
                                </TabItem>

                                <!-- Financial Summary Tab -->
                                <TabItem Header="💰 Financial Summary">
                                    <ScrollViewer VerticalScrollBarVisibility="Auto">
                                        <StackPanel Margin="20">
                                            <!-- Financial Overview -->
                                            <Border Background="White" BorderBrush="#dee2e6" BorderThickness="1" 
                                                    CornerRadius="6" Padding="20" Margin="0,0,0,20">
                                                <StackPanel>
                                                    <TextBlock Text="💰 Financial Overview" FontSize="16" FontWeight="SemiBold" 
                                                            Margin="0,0,0,15" Foreground="#2c3e50"/>

                                                    <Grid>
                                                        <Grid.ColumnDefinitions>
                                                            <ColumnDefinition Width="*"/>
                                                            <ColumnDefinition Width="*"/>
                                                        </Grid.ColumnDefinitions>

                                                        <StackPanel Grid.Column="0">
                                                            <TextBlock x:Name="TotalPurchaseValueText" Text="Total Purchases: $0.00" FontSize="14" Margin="0,5"/>
                                                            <TextBlock x:Name="TotalConsumptionValueText" Text="Total Consumption: $0.00" FontSize="14" Margin="0,5"/>
                                                            <TextBlock x:Name="RemainingInventoryText" Text="Remaining Inventory: $0.00" FontSize="14" Margin="0,5"/>
                                                        </StackPanel>

                                                        <StackPanel Grid.Column="1">
                                                            <TextBlock x:Name="AvgCostPerLiterText" Text="Avg Cost/L: $0.000000" FontSize="14" Margin="0,5"/>
                                                            <TextBlock x:Name="AvgCostPerTonText" Text="Avg Cost/T: $0.00" FontSize="14" Margin="0,5"/>
                                                        </StackPanel>
                                                    </Grid>
                                                </StackPanel>
                                            </Border>

                                            <!-- Currency Breakdown -->
                                            <Border Background="White" BorderBrush="#dee2e6" BorderThickness="1" 
                                                    CornerRadius="6" Padding="20" Margin="0,0,0,20">
                                                <StackPanel>
                                                    <TextBlock Text="💱 Currency Breakdown" FontSize="16" FontWeight="SemiBold" 
                                                            Margin="0,0,0,15" Foreground="#2c3e50"/>

                                                    <DataGrid x:Name="CurrencyBreakdownGrid" 
                                                            AutoGenerateColumns="False" 
                                                            CanUserAddRows="False"
                                                            CanUserDeleteRows="False"
                                                            GridLinesVisibility="Horizontal"
                                                            HeadersVisibility="Column"
                                                            Background="White"
                                                            BorderThickness="0">

                                                        <DataGrid.Columns>
                                                            <DataGridTextColumn Header="Currency" Binding="{Binding Currency}" Width="100"/>
                                                            <DataGridTextColumn Header="Total Value" Binding="{Binding TotalValue, StringFormat=N3}" Width="150"/>
                                                            <DataGridTextColumn Header="USD Value" Binding="{Binding TotalValueUSD, StringFormat=C2}" Width="150"/>
                                                            <DataGridTextColumn Header="Exchange Rate" Binding="{Binding ExchangeRate, StringFormat=N6}" Width="150"/>
                                                        </DataGrid.Columns>
                                                    </DataGrid>
                                                </StackPanel>
                                            </Border>

                                            <!-- Payment Status -->
                                            <Border Background="White" BorderBrush="#dee2e6" BorderThickness="1" 
                                                    CornerRadius="6" Padding="20">
                                                <StackPanel>
                                                    <TextBlock Text="📋 Payment Status" FontSize="16" FontWeight="SemiBold" 
                                                            Margin="0,0,0,15" Foreground="#2c3e50"/>

                                                    <DataGrid x:Name="PaymentStatusGrid" 
                                                            AutoGenerateColumns="False" 
                                                            CanUserAddRows="False"
                                                            CanUserDeleteRows="False"
                                                            GridLinesVisibility="Horizontal"
                                                            HeadersVisibility="Column"
                                                            Background="White"
                                                            BorderThickness="0">

                                                        <DataGrid.Columns>
                                                            <DataGridTextColumn Header="Supplier" Binding="{Binding SupplierName}" Width="150"/>
                                                            <DataGridTextColumn Header="Total Due" Binding="{Binding TotalDue, StringFormat=C2}" Width="120"/>
                                                            <DataGridTextColumn Header="Overdue" Binding="{Binding TotalOverdue, StringFormat=C2}" Width="120"/>
                                                            <DataGridTextColumn Header="Overdue Count" Binding="{Binding OverdueCount}" Width="120"/>
                                                            <DataGridTextColumn Header="Total Invoices" Binding="{Binding TotalInvoices}" Width="120"/>
                                                        </DataGrid.Columns>
                                                    </DataGrid>
                                                </StackPanel>
                                            </Border>
                                        </StackPanel>
                                    </ScrollViewer>
                                </TabItem>

                                <!-- Other Summary tabs will be added here -->
                            </TabControl>
                        </Grid>
                    </ScrollViewer>
                </TabItem>

                <!-- Vessel Account Statement Tab -->
                <TabItem Header="🚢 Vessel Account Statement">
                    <Grid Margin="20">
                        <Grid.RowDefinitions>
                            <RowDefinition Height="Auto"/>
                            <!-- Controls -->
                            <RowDefinition Height="Auto"/>
                            <!-- Summary -->
                            <RowDefinition Height="*"/>
                            <!-- Statement -->
                        </Grid.RowDefinitions>

                        <!-- Controls -->
                        <Border Grid.Row="0" Background="#f8f9fa" BorderBrush="#dee2e6" BorderThickness="1" 
                              CornerRadius="8" Padding="20" Margin="0,0,0,20">
                            <Grid>
                                <Grid.ColumnDefinitions>
                                    <ColumnDefinition Width="*"/>
                                    <ColumnDefinition Width="Auto"/>
                                </Grid.ColumnDefinitions>

                                <StackPanel Grid.Column="0" Orientation="Horizontal">
                                    <TextBlock Text="Vessel:" FontWeight="SemiBold" VerticalAlignment="Center" Margin="0,0,10,0"/>
                                    <ComboBox x:Name="VesselAccountComboBox" MinWidth="150" Padding="10,8" 
                                            DisplayMemberPath="Name" SelectedValuePath="Id" Margin="0,0,20,0"/>

                                    <TextBlock Text="From:" FontWeight="SemiBold" VerticalAlignment="Center" Margin="0,0,10,0"/>
                                    <DatePicker x:Name="VesselFromDatePicker" Padding="10,8" BorderBrush="#ced4da" 
                                              BorderThickness="1" Margin="0,0,15,0"/>

                                    <TextBlock Text="To:" FontWeight="SemiBold" VerticalAlignment="Center" Margin="0,0,10,0"/>
                                    <DatePicker x:Name="VesselToDatePicker" Padding="10,8" BorderBrush="#ced4da" 
                                              BorderThickness="1" Margin="0,0,15,0"/>

                                    <Button x:Name="GenerateVesselAccountBtn" Content="📊 Generate Statement" 
                                          Background="#007bff" Foreground="White" BorderThickness="0" 
                                          Padding="15,10" FontWeight="SemiBold"
                                          Click="GenerateVesselAccount_Click"/>
                                </StackPanel>

                                <StackPanel Grid.Column="1" Orientation="Horizontal">
                                    <Button x:Name="ExportVesselBtn" Content="📤 Export" 
                                          Background="#28a745" Foreground="White" BorderThickness="0" 
                                          Padding="15,10" FontWeight="SemiBold"
                                          Click="ExportVessel_Click"/>
                                    <Button Content="🖨️ Print Report" 
                                          Background="#6c757d" Foreground="White" BorderThickness="0" 
                                          Padding="15,8" Margin="10,0,0,0" FontWeight="SemiBold"
                                          Click="PrintVesselAccount_Click"/>
                                </StackPanel>
                            </Grid>
                        </Border>

                        <!-- Vessel Summary -->
                        <Border Grid.Row="1" Background="#e8f5e8" BorderBrush="#4caf50" BorderThickness="1" 
                              CornerRadius="8" Padding="20" Margin="0,0,0,20">
                            <Grid>
                                <Grid.ColumnDefinitions>
                                    <ColumnDefinition Width="*"/>
                                    <ColumnDefinition Width="*"/>
                                    <ColumnDefinition Width="*"/>
                                    <ColumnDefinition Width="*"/>
                                    <ColumnDefinition Width="*"/>
                                </Grid.ColumnDefinitions>

                                <StackPanel Grid.Column="0" HorizontalAlignment="Center">
                                    <TextBlock Text="🚢 Vessel" FontWeight="SemiBold" HorizontalAlignment="Center" FontSize="12"/>
                                    <TextBlock x:Name="VesselNameText" Text="Not Selected" FontSize="16" FontWeight="Bold" 
                                             HorizontalAlignment="Center" Foreground="#2e7d32"/>
                                </StackPanel>

                                <StackPanel Grid.Column="1" HorizontalAlignment="Center">
                                    <TextBlock Text="⛽ Total Purchases" FontWeight="SemiBold" HorizontalAlignment="Center" FontSize="12"/>
                                    <TextBlock x:Name="VesselTotalPurchasesText" Text="0.000 L" FontSize="16" FontWeight="Bold" 
                                             HorizontalAlignment="Center" Foreground="#2e7d32"/>
                                </StackPanel>

                                <StackPanel Grid.Column="2" HorizontalAlignment="Center">
                                    <TextBlock Text="🔥 Total Consumption" FontWeight="SemiBold" HorizontalAlignment="Center" FontSize="12"/>
                                    <TextBlock x:Name="VesselTotalConsumptionText" Text="0.000 L" FontSize="16" FontWeight="Bold" 
                                             HorizontalAlignment="Center" Foreground="#2e7d32"/>
                                </StackPanel>

                                <StackPanel Grid.Column="3" HorizontalAlignment="Center">
                                    <TextBlock Text="📦 Current Balance" FontWeight="SemiBold" HorizontalAlignment="Center" FontSize="12"/>
                                    <TextBlock x:Name="VesselCurrentBalanceText" Text="0.000 L" FontSize="16" FontWeight="Bold" 
                                             HorizontalAlignment="Center" Foreground="#2e7d32"/>
                                </StackPanel>

                                <StackPanel Grid.Column="4" HorizontalAlignment="Center">
                                    <TextBlock Text="💰 Total Value" FontWeight="SemiBold" HorizontalAlignment="Center" FontSize="12"/>
                                    <TextBlock x:Name="VesselTotalValueText" Text="$0.00" FontSize="16" FontWeight="Bold" 
                                             HorizontalAlignment="Center" Foreground="#2e7d32"/>
                                </StackPanel>
                            </Grid>
                        </Border>

                        <!-- Account Statement -->
                        <Border Grid.Row="2" Background="White" BorderBrush="#dee2e6" BorderThickness="1" 
                              CornerRadius="6" Padding="20">
                            <StackPanel>
                                <TextBlock Text="📋 Vessel Account Statement" FontSize="16" FontWeight="SemiBold" 
                                         Margin="0,0,0,15" Foreground="#2c3e50"/>

                                <DataGrid x:Name="VesselAccountGrid" 
                                        AutoGenerateColumns="False" 
                                        CanUserAddRows="False"
                                        CanUserDeleteRows="False"
                                        GridLinesVisibility="Horizontal"
                                        HeadersVisibility="Column"
                                        Background="White"
                                        BorderThickness="0"
                                        MaxHeight="500">

                                    <DataGrid.Columns>
                                        <DataGridTextColumn Header="Date" Binding="{Binding TransactionDate, StringFormat=dd/MM/yyyy}" Width="100"/>
                                        <DataGridTextColumn Header="Type" Binding="{Binding TransactionType}" Width="100"/>
                                        <DataGridTextColumn Header="Reference" Binding="{Binding Reference}" Width="120"/>
                                        <DataGridTextColumn Header="Supplier" Binding="{Binding SupplierName}" Width="120"/>
                                        <DataGridTextColumn Header="Debit (L)" Binding="{Binding DebitQuantity, StringFormat=N3}" Width="100"/>
                                        <DataGridTextColumn Header="Credit (L)" Binding="{Binding CreditQuantity, StringFormat=N3}" Width="100"/>
                                        <DataGridTextColumn Header="Balance (L)" Binding="{Binding FormattedRunningBalance}" Width="100"/>
                                        <DataGridTextColumn Header="Value (USD)" Binding="{Binding FormattedValueUSD}" Width="100"/>
                                        <DataGridTextColumn Header="Description" Binding="{Binding Description}" Width="*"/>
                                    </DataGrid.Columns>
                                </DataGrid>

                                <!-- Vessel Account Totals -->
                                <Grid Margin="0,15,0,0" Background="#f8f9fa">
                                    <Border BorderBrush="#dee2e6" BorderThickness="1" CornerRadius="4" 
                                            Background="#f8f9fa" Margin="1,0,0,0">
                                        <Grid Margin="6,15,0,15">
                                            <Grid.ColumnDefinitions>
                                                <ColumnDefinition Width="100"/>
                                                <!-- Date -->
                                                <ColumnDefinition Width="100"/>
                                                <!-- Type -->
                                                <ColumnDefinition Width="120"/>
                                                <!-- Reference -->
                                                <ColumnDefinition Width="120"/>
                                                <!-- Supplier -->
                                                <ColumnDefinition Width="100"/>
                                                <!-- Debit (L) -->
                                                <ColumnDefinition Width="100"/>
                                                <!-- Credit (L) -->
                                                <ColumnDefinition Width="100"/>
                                                <!-- Balance (L) -->
                                                <ColumnDefinition Width="100"/>
                                                <!-- Value (USD) -->
                                                <ColumnDefinition Width="*"/>
                                                <!-- Description -->
                                            </Grid.ColumnDefinitions>

                                            <TextBlock Grid.Column="0" Text="" FontWeight="Bold"/>
                                            <TextBlock Grid.Column="1" Text="" FontWeight="Bold"/>
                                            <TextBlock Grid.Column="2" Text="" FontWeight="Bold"/>
                                            <TextBlock Grid.Column="3" Text="TOTALS:" FontWeight="Bold" 
                                                    HorizontalAlignment="Right" Foreground="#2c3e50"/>
                                            <TextBlock Grid.Column="4" x:Name="VesselTotalDebitsText" Text="0.000" 
                                                    FontWeight="Bold" HorizontalAlignment="Center" Foreground="#2c3e50"/>
                                            <TextBlock Grid.Column="5" x:Name="VesselTotalCreditsText" Text="0.000" 
                                                    FontWeight="Bold" HorizontalAlignment="Center" Foreground="#2c3e50"/>
                                            <TextBlock Grid.Column="6" x:Name="VesselNetBalanceText" Text="0.000" 
                                                    FontWeight="Bold" HorizontalAlignment="Center" Foreground="#2c3e50"/>
                                            <TextBlock Grid.Column="7" x:Name="VesselAccountTotalValueText" Text="$0.00" 
                                                    FontWeight="Bold" HorizontalAlignment="Center" Foreground="#2c3e50"/>
                                            <TextBlock Grid.Column="8" Text="" FontWeight="Bold"/>
                                        </Grid>
                                    </Border>
                                </Grid>
                            </StackPanel>
                        </Border>
                    </Grid>
                </TabItem>

                <!-- Supplier Account Report Tab -->
                <TabItem Header="🏢 Supplier Account Report">
                    <Grid Margin="20">
                        <Grid.RowDefinitions>
                            <RowDefinition Height="Auto"/>
                            <!-- Controls -->
                            <RowDefinition Height="Auto"/>
                            <!-- Summary -->
                            <RowDefinition Height="*"/>
                            <!-- Report -->
                        </Grid.RowDefinitions>

                        <!-- Controls -->
                        <Border Grid.Row="0" Background="#f8f9fa" BorderBrush="#dee2e6" BorderThickness="1" 
                              CornerRadius="8" Padding="20" Margin="0,0,0,20">
                            <Grid>
                                <Grid.ColumnDefinitions>
                                    <ColumnDefinition Width="*"/>
                                    <ColumnDefinition Width="Auto"/>
                                </Grid.ColumnDefinitions>

                                <StackPanel Grid.Column="0" Orientation="Horizontal">
                                    <TextBlock Text="Supplier:" FontWeight="SemiBold" VerticalAlignment="Center" Margin="0,0,10,0"/>
                                    <ComboBox x:Name="SupplierAccountComboBox" MinWidth="150" Padding="10,8" 
                                            DisplayMemberPath="Name" SelectedValuePath="Id" Margin="0,0,20,0"/>

                                    <TextBlock Text="From:" FontWeight="SemiBold" VerticalAlignment="Center" Margin="0,0,10,0"/>
                                    <DatePicker x:Name="SupplierFromDatePicker" Padding="10,8" BorderBrush="#ced4da" 
                                              BorderThickness="1" Margin="0,0,15,0"/>

                                    <TextBlock Text="To:" FontWeight="SemiBold" VerticalAlignment="Center" Margin="0,0,10,0"/>
                                    <DatePicker x:Name="SupplierToDatePicker" Padding="10,8" BorderBrush="#ced4da" 
                                              BorderThickness="1" Margin="0,0,15,0"/>

                                    <Button x:Name="GenerateSupplierAccountBtn" Content="📊 Generate Report" 
                                          Background="#007bff" Foreground="White" BorderThickness="0" 
                                          Padding="15,10" FontWeight="SemiBold"
                                          Click="GenerateSupplierAccount_Click"/>
                                </StackPanel>

                                <StackPanel Grid.Column="1" Orientation="Horizontal">
                                    <Button x:Name="ExportSupplierBtn" Content="📤 Export" 
                                          Background="#28a745" Foreground="White" BorderThickness="0" 
                                          Padding="15,10" Margin="0,0,10,0" FontWeight="SemiBold"
                                          Click="ExportSupplier_Click"/>
                                    <Button x:Name="PrintSupplierBtn" Content="🖨️ Print Report" 
                                          Background="#6c757d" Foreground="White" BorderThickness="0" 
                                          Padding="15,10" FontWeight="SemiBold"
                                          Click="PrintVesselAccount_Click"/>
                                </StackPanel>
                            </Grid>
                        </Border>

                        <!-- Supplier Summary -->
                        <Border Grid.Row="1" Background="#fff3cd" BorderBrush="#ffc107" BorderThickness="1" 
                              CornerRadius="8" Padding="20" Margin="0,0,0,20">
                            <Grid>
                                <Grid.ColumnDefinitions>
                                    <ColumnDefinition Width="*"/>
                                    <ColumnDefinition Width="*"/>
                                    <ColumnDefinition Width="*"/>
                                    <ColumnDefinition Width="*"/>
                                    <ColumnDefinition Width="*"/>
                                </Grid.ColumnDefinitions>

                                <StackPanel Grid.Column="0" HorizontalAlignment="Center">
                                    <TextBlock Text="🏢 Supplier" FontWeight="SemiBold" HorizontalAlignment="Center" FontSize="12"/>
                                    <TextBlock x:Name="SupplierNameText" Text="Not Selected" FontSize="16" FontWeight="Bold" 
                                             HorizontalAlignment="Center" Foreground="#856404"/>
                                </StackPanel>

                                <StackPanel Grid.Column="1" HorizontalAlignment="Center">
                                    <TextBlock Text="📦 Beginning Balance" FontWeight="SemiBold" HorizontalAlignment="Center" FontSize="12"/>
                                    <TextBlock x:Name="SupplierBeginningBalanceText" Text="0.000 L" FontSize="16" FontWeight="Bold" 
                                             HorizontalAlignment="Center" Foreground="#856404"/>
                                </StackPanel>

                                <StackPanel Grid.Column="2" HorizontalAlignment="Center">
                                    <TextBlock Text="⛽ Period Purchases" FontWeight="SemiBold" HorizontalAlignment="Center" FontSize="12"/>
                                    <TextBlock x:Name="SupplierPeriodPurchasesText" Text="0.000 L" FontSize="16" FontWeight="Bold" 
                                             HorizontalAlignment="Center" Foreground="#856404"/>
                                </StackPanel>

                                <StackPanel Grid.Column="3" HorizontalAlignment="Center">
                                    <TextBlock Text="🔥 Period Consumption" FontWeight="SemiBold" HorizontalAlignment="Center" FontSize="12"/>
                                    <TextBlock x:Name="SupplierPeriodConsumptionText" Text="0.000 L" FontSize="16" FontWeight="Bold" 
                                             HorizontalAlignment="Center" Foreground="#856404"/>
                                </StackPanel>

                                <StackPanel Grid.Column="4" HorizontalAlignment="Center">
                                    <TextBlock Text="📊 Ending Balance" FontWeight="SemiBold" HorizontalAlignment="Center" FontSize="12"/>
                                    <TextBlock x:Name="SupplierEndingBalanceText" Text="0.000 L" FontSize="16" FontWeight="Bold" 
                                             HorizontalAlignment="Center" Foreground="#856404"/>
                                </StackPanel>
                            </Grid>
                        </Border>

                        <!-- Supplier Report -->
                        <Border Grid.Row="2" Background="White" BorderBrush="#dee2e6" BorderThickness="1" 
                              CornerRadius="6" Padding="20">
                            <StackPanel>
                                <TextBlock Text="📋 Supplier Account Report" FontSize="16" FontWeight="SemiBold" 
                                         Margin="0,0,0,15" Foreground="#2c3e50"/>

                                <DataGrid x:Name="SupplierAccountGrid" 
                                        AutoGenerateColumns="False" 
                                        CanUserAddRows="False"
                                        CanUserDeleteRows="False"
                                        GridLinesVisibility="Horizontal"
                                        HeadersVisibility="Column"
                                        Background="White"
                                        BorderThickness="0"
                                        MaxHeight="500">

                                    <DataGrid.Columns>
                                        <DataGridTextColumn Header="Date" Binding="{Binding TransactionDate, StringFormat=dd/MM/yyyy}" Width="100"/>
                                        <DataGridTextColumn Header="Vessel" Binding="{Binding VesselName}" Width="120"/>
                                        <DataGridTextColumn Header="Type" Binding="{Binding TransactionType}" Width="100"/>
                                        <DataGridTextColumn Header="Reference" Binding="{Binding Reference}" Width="120"/>
                                        <DataGridTextColumn Header="Purchases (L)" Binding="{Binding PurchaseQuantity, StringFormat=N3}" Width="120"/>
                                        <DataGridTextColumn Header="Consumption (L)" Binding="{Binding ConsumptionQuantity, StringFormat=N3}" Width="120"/>
                                        <DataGridTextColumn Header="Value" Binding="{Binding FormattedValue}" Width="120"/>
                                        <DataGridTextColumn Header="USD Value" Binding="{Binding FormattedValueUSD}" Width="100"/>
                                        <DataGridTextColumn Header="Balance (L)" Binding="{Binding RunningBalance, StringFormat=N3}" Width="100"/>
                                    </DataGrid.Columns>
                                </DataGrid>

                                <!-- Supplier Account Totals -->
                                <Grid Margin="0,15,0,0" Background="#fff3cd">
                                    <Border BorderBrush="#ffc107" BorderThickness="1" CornerRadius="4" 
                                            Background="#fff3cd" Margin="1,0,0,0">
                                        <Grid Margin="6,15,0,15">
                                            <Grid.ColumnDefinitions>
                                                <ColumnDefinition Width="100"/>
                                                <!-- Date -->
                                                <ColumnDefinition Width="120"/>
                                                <!-- Vessel -->
                                                <ColumnDefinition Width="100"/>
                                                <!-- Type -->
                                                <ColumnDefinition Width="120"/>
                                                <!-- Reference -->
                                                <ColumnDefinition Width="120"/>
                                                <!-- Purchases (L) -->
                                                <ColumnDefinition Width="120"/>
                                                <!-- Consumption (L) -->
                                                <ColumnDefinition Width="120"/>
                                                <!-- Value -->
                                                <ColumnDefinition Width="100"/>
                                                <!-- USD Value -->
                                                <ColumnDefinition Width="100"/>
                                                <!-- Balance (L) -->
                                            </Grid.ColumnDefinitions>

                                            <TextBlock Grid.Column="0" Text="" FontWeight="Bold"/>
                                            <TextBlock Grid.Column="1" Text="" FontWeight="Bold"/>
                                            <TextBlock Grid.Column="2" Text="" FontWeight="Bold"/>
                                            <TextBlock Grid.Column="3" Text="TOTALS:" FontWeight="Bold" 
                                                    HorizontalAlignment="Right" Foreground="#856404"/>
                                            <TextBlock Grid.Column="4" x:Name="SupplierTotalPurchasesText" Text="0.000" 
                                                    FontWeight="Bold" HorizontalAlignment="Center" Foreground="#856404"/>
                                            <TextBlock Grid.Column="5" x:Name="SupplierTotalConsumptionText" Text="0.000" 
                                                    FontWeight="Bold" HorizontalAlignment="Center" Foreground="#856404"/>
                                            <TextBlock Grid.Column="6" x:Name="SupplierAccountTotalValueText" Text="0.000 USD" 
                                                    FontWeight="Bold" HorizontalAlignment="Center" Foreground="#856404"/>
                                            <TextBlock Grid.Column="7" x:Name="SupplierAccountTotalUSDText" Text="$0.00" 
                                                    FontWeight="Bold" HorizontalAlignment="Center" Foreground="#856404"/>
                                            <TextBlock Grid.Column="8" x:Name="SupplierNetBalanceText" Text="0.000" 
                                                    FontWeight="Bold" HorizontalAlignment="Center" Foreground="#856404"/>
                                        </Grid>
                                    </Border>
                                </Grid>

                            </StackPanel>
                        </Border>
                    </Grid>
                </TabItem>

                <!-- Payment Due Report Tab -->
                <TabItem Header="💳 Payment Due Report">
                    <Grid Margin="20">
                        <Grid.RowDefinitions>
                            <RowDefinition Height="Auto"/>
                            <!-- Controls -->
                            <RowDefinition Height="Auto"/>
                            <!-- Summary -->
                            <RowDefinition Height="*"/>
                            <!-- Report -->
                        </Grid.RowDefinitions>

                        <!-- Controls -->
                        <Border Grid.Row="0" Background="#f8f9fa" BorderBrush="#dee2e6" BorderThickness="1" 
                            CornerRadius="8" Padding="20" Margin="0,0,0,20">
                            <Grid>
                                <Grid.ColumnDefinitions>
                                    <ColumnDefinition Width="*"/>
                                    <ColumnDefinition Width="Auto"/>
                                </Grid.ColumnDefinitions>

                                <StackPanel Grid.Column="0" Orientation="Horizontal">
                                    <Button x:Name="GeneratePaymentReportBtn" Content="📊 Generate Payment Report" 
                                        Background="#007bff" Foreground="White" BorderThickness="0" 
                                        Padding="15,10" FontWeight="SemiBold"
                                        Click="GeneratePaymentReport_Click"/>

                                    <TextBlock Text="Real-time payment status and aging analysis" 
                                            VerticalAlignment="Center" Margin="20,0,0,0" 
                                            FontStyle="Italic" Foreground="Gray"/>
                                </StackPanel>

                                <StackPanel Grid.Column="1" Orientation="Horizontal">
                                    <Button x:Name="ExportPaymentBtn" Content="📤 Export" 
                                        Background="#28a745" Foreground="White" BorderThickness="0" 
                                        Padding="15,10" Margin="0,0,10,0" FontWeight="SemiBold"
                                        Click="ExportPayment_Click"/>
                                    <Button x:Name="PrintPaymentBtn" Content="🖨️ Print Report" 
                                        Background="#6c757d" Foreground="White" BorderThickness="0" 
                                        Padding="15,10" FontWeight="SemiBold"
                                        Click="PrintVesselAccount_Click"/>
                                </StackPanel>
                            </Grid>
                        </Border>

                        <!-- Payment Summary Cards -->
                        <Border Grid.Row="1" Background="#fff" BorderBrush="#dee2e6" BorderThickness="1" 
                                CornerRadius="8" Padding="20" Margin="0,0,0,20">
                            <Grid>
                                <Grid.ColumnDefinitions>
                                    <ColumnDefinition Width="*"/>
                                    <ColumnDefinition Width="*"/>
                                    <ColumnDefinition Width="*"/>
                                    <ColumnDefinition Width="*"/>
                                    <ColumnDefinition Width="*"/>
                                </Grid.ColumnDefinitions>

                                <StackPanel Grid.Column="0" HorizontalAlignment="Center">
                                    <TextBlock Text="▲ Overdue" FontWeight="SemiBold" HorizontalAlignment="Center" FontSize="12" Foreground="#dc3545"/>
                                    <TextBlock x:Name="OverdueAmountText" Text="$0.00" FontSize="16" FontWeight="Bold" 
                                            HorizontalAlignment="Center" Foreground="#dc3545"/>
                                    <TextBlock x:Name="OverdueCountText" Text="0 invoices" FontSize="10" 
                                            HorizontalAlignment="Center" Foreground="#dc3545"/>
                                </StackPanel>

                                <StackPanel Grid.Column="1" HorizontalAlignment="Center">
                                    <TextBlock Text="⚠ Due Today" FontWeight="SemiBold" HorizontalAlignment="Center" FontSize="12" Foreground="#fd7e14"/>
                                    <TextBlock x:Name="DueTodayAmountText" Text="$0.00" FontSize="16" FontWeight="Bold" 
                                            HorizontalAlignment="Center" Foreground="#fd7e14"/>
                                    <TextBlock x:Name="DueTodayCountText" Text="0 invoices" FontSize="10" 
                                            HorizontalAlignment="Center" Foreground="#fd7e14"/>
                                </StackPanel>

                                <StackPanel Grid.Column="2" HorizontalAlignment="Center">
                                    <TextBlock Text="⏰ This Week" FontWeight="SemiBold" HorizontalAlignment="Center" FontSize="12" Foreground="#ffc107"/>
                                    <TextBlock x:Name="DueThisWeekAmountText" Text="$0.00" FontSize="16" FontWeight="Bold" 
                                            HorizontalAlignment="Center" Foreground="#ffc107"/>
                                    <TextBlock x:Name="DueThisWeekCountText" Text="0 invoices" FontSize="10" 
                                            HorizontalAlignment="Center" Foreground="#ffc107"/>
                                </StackPanel>

                                <StackPanel Grid.Column="3" HorizontalAlignment="Center">
                                    <TextBlock Text="→ Next Week" FontWeight="SemiBold" HorizontalAlignment="Center" FontSize="12" Foreground="#28a745"/>
                                    <TextBlock x:Name="DueNextWeekAmountText" Text="$0.00" FontSize="16" FontWeight="Bold" 
                                            HorizontalAlignment="Center" Foreground="#28a745"/>
                                    <TextBlock x:Name="DueNextWeekCountText" Text="0 invoices" FontSize="10" 
                                            HorizontalAlignment="Center" Foreground="#28a745"/>
                                </StackPanel>

                                <StackPanel Grid.Column="4" HorizontalAlignment="Center">
                                    <TextBlock Text="📊 Total Outstanding" FontWeight="SemiBold" HorizontalAlignment="Center" FontSize="12" Foreground="#6c757d"/>
                                    <TextBlock x:Name="TotalOutstandingAmountText" Text="$0.00" FontSize="16" FontWeight="Bold" 
                                            HorizontalAlignment="Center" Foreground="#6c757d"/>
                                    <TextBlock x:Name="TotalOutstandingCountText" Text="0 invoices" FontSize="10" 
                                            HorizontalAlignment="Center" Foreground="#6c757d"/>
                                </StackPanel>
                            </Grid>
                        </Border>

                        <!-- Payment Report Tabs -->
                        <TabControl Grid.Row="2" x:Name="PaymentTabControl">

                            <!-- Payment Schedule Tab -->
                            <TabItem Header="📅 Payment Schedule">
                                <StackPanel Margin="20">
                                    <TextBlock Text="All Outstanding Invoices by Due Date" FontSize="16" FontWeight="SemiBold" 
                                            Margin="0,0,0,15" Foreground="#2c3e50"/>

                                    <DataGrid x:Name="PaymentScheduleGrid" 
                                            AutoGenerateColumns="False" 
                                            CanUserAddRows="False"
                                            CanUserDeleteRows="False"
                                            GridLinesVisibility="Horizontal"
                                            HeadersVisibility="Column"
                                            Background="White"
                                            BorderThickness="1"
                                            BorderBrush="#dee2e6"
                                            MaxHeight="500">

                                        <DataGrid.Columns>
                                            <DataGridTextColumn Header="Due Date" Binding="{Binding FormattedDueDate}" Width="100"/>
                                            <DataGridTextColumn Header="Invoice Ref" Binding="{Binding InvoiceReference}" Width="100"/>
                                            <DataGridTextColumn Header="Supplier" Binding="{Binding SupplierName}" Width="120"/>
                                            <DataGridTextColumn Header="Vessel" Binding="{Binding VesselName}" Width="120"/>
                                            <DataGridTextColumn Header="Amount" Binding="{Binding FormattedValue}" Width="120"/>
                                            <DataGridTextColumn Header="USD Amount" Binding="{Binding TotalValueUSD, StringFormat=C2}" Width="100"/>
                                            <DataGridTextColumn Header="Status" Binding="{Binding StatusText}" Width="120"/>
                                            <DataGridTextColumn Header="Receipt Date" Binding="{Binding FormattedReceiptDate}" Width="100"/>
                                            <DataGridTextColumn Header="Aging" Binding="{Binding AgingCategory}" Width="100"/>
                                            <DataGridTemplateColumn Header="Action" Width="120">
                                                <DataGridTemplateColumn.CellTemplate>
                                                    <DataTemplate>
                                                        <Button Content="💳 Pay Invoice" 
                                                               Background="#28a745" 
                                                               Foreground="White" 
                                                               BorderThickness="0" 
                                                               Padding="8,4" 
                                                               FontSize="11"
                                                               FontWeight="SemiBold"
                                                               Click="PayInvoice_Click"
                                                               Tag="{Binding PurchaseId}"/>
                                                    </DataTemplate>
                                                </DataGridTemplateColumn.CellTemplate>
                                            </DataGridTemplateColumn>
                                        </DataGrid.Columns>
                                    </DataGrid>
                                </StackPanel>
                            </TabItem>

                            <!-- Aging Analysis Tab -->
                            <TabItem Header="📊 Aging Analysis">
                                <StackPanel Margin="20">
                                    <TextBlock Text="Payment Aging by Supplier" FontSize="16" FontWeight="SemiBold" 
                                            Margin="0,0,0,15" Foreground="#2c3e50"/>

                                    <DataGrid x:Name="AgingAnalysisGrid" 
                                            AutoGenerateColumns="False" 
                                            CanUserAddRows="False"
                                            CanUserDeleteRows="False"
                                            GridLinesVisibility="Horizontal"
                                            HeadersVisibility="Column"
                                            Background="White"
                                            BorderThickness="1"
                                            BorderBrush="#dee2e6"
                                            MaxHeight="500">

                                        <DataGrid.Columns>
                                            <DataGridTextColumn Header="Supplier" Binding="{Binding SupplierName}" Width="150"/>
                                            <DataGridTextColumn Header="Currency" Binding="{Binding Currency}" Width="80"/>
                                            <DataGridTextColumn Header="Total Outstanding" Binding="{Binding FormattedOutstanding}" Width="140"/>
                                            <DataGridTextColumn Header="Total Overdue" Binding="{Binding FormattedOverdue}" Width="120"/>
                                            <DataGridTextColumn Header="Total Invoices" Binding="{Binding TotalInvoices}" Width="100"/>
                                            <DataGridTextColumn Header="Overdue Invoices" Binding="{Binding OverdueInvoices}" Width="120"/>
                                            <DataGridTextColumn Header="Avg Days Overdue" Binding="{Binding AvgDaysOverdue, StringFormat=N1}" Width="130"/>
                                        </DataGrid.Columns>
                                    </DataGrid>
                                </StackPanel>
                            </TabItem>

                            <!-- NEW: Paid Invoices Tab -->
                            <TabItem Header="✅ Paid Invoices">
                                <StackPanel Margin="20">
                                    <TextBlock Text="All Paid Invoices (Most Recent First)" FontSize="16" FontWeight="SemiBold" 
                                            Margin="0,0,0,15" Foreground="#2c3e50"/>

                                    <DataGrid x:Name="PaidInvoicesGrid" 
                                            AutoGenerateColumns="False" 
                                            CanUserAddRows="False"
                                            CanUserDeleteRows="False"
                                            GridLinesVisibility="Horizontal"
                                            HeadersVisibility="Column"
                                            Background="White"
                                            BorderThickness="1"
                                            BorderBrush="#dee2e6"
                                            MaxHeight="500">

                                        <DataGrid.Columns>
                                            <DataGridTextColumn Header="Payment Date" Binding="{Binding FormattedPaymentDate}" Width="110"/>
                                            <DataGridTextColumn Header="Invoice Ref" Binding="{Binding InvoiceReference}" Width="100"/>
                                            <DataGridTextColumn Header="Supplier" Binding="{Binding SupplierName}" Width="120"/>
                                            <DataGridTextColumn Header="Vessel" Binding="{Binding VesselName}" Width="120"/>
                                            <DataGridTextColumn Header="Original Amount" Binding="{Binding FormattedValue}" Width="120"/>
                                            <DataGridTextColumn Header="USD Amount" Binding="{Binding TotalValueUSD, StringFormat=C2}" Width="100"/>
                                            <DataGridTextColumn Header="Due Date" Binding="{Binding FormattedDueDate}" Width="100"/>
                                            <DataGridTextColumn Header="Receipt Date" Binding="{Binding FormattedReceiptDate}" Width="100"/>
                                            <DataGridTextColumn Header="Status" Width="80">
                                                <DataGridTextColumn.Binding>
                                                    <Binding Source="PAID"/>
                                                </DataGridTextColumn.Binding>
                                            </DataGridTextColumn>
                                        </DataGrid.Columns>
                                    </DataGrid>
                                </StackPanel>
                            </TabItem>
                        </TabControl>
                    </Grid>
                </TabItem>

                <TabItem Header="📦 Inventory Valuation">
                    <Grid Margin="20">
                        <Grid.RowDefinitions>
                            <RowDefinition Height="Auto"/>
                            <!-- Controls -->
                            <RowDefinition Height="Auto"/>
                            <!-- Summary -->
                            <RowDefinition Height="*"/>
                            <!-- Content -->
                        </Grid.RowDefinitions>

                        <!-- Controls -->
                        <Border Grid.Row="0" Background="#f8f9fa" BorderBrush="#dee2e6" BorderThickness="1" 
                                CornerRadius="8" Padding="20" Margin="0,0,0,20">
                            <Grid>
                                <Grid.ColumnDefinitions>
                                    <ColumnDefinition Width="*"/>
                                    <ColumnDefinition Width="Auto"/>
                                </Grid.ColumnDefinitions>

                                <StackPanel Grid.Column="0" Orientation="Horizontal">
                                    <Button x:Name="GenerateInventoryBtn" Content="📦 Generate Inventory Report" 
                                          Background="#007bff" Foreground="White" BorderThickness="0" 
                                          Padding="15,10" FontWeight="SemiBold"
                                          Click="GenerateInventory_Click"/>

                                    <TextBlock Text="Real-time FIFO inventory valuation" 
                                        VerticalAlignment="Center" Margin="20,0,0,0" 
                                        FontStyle="Italic" Foreground="Gray"/>
                                </StackPanel>

                                <StackPanel Grid.Column="1" Orientation="Horizontal">
                                    <Button x:Name="ExportInventoryBtn" Content="📤 Export" 
                                          Background="#28a745" Foreground="White" BorderThickness="0" 
                                          Padding="15,10" Margin="0,0,10,0" FontWeight="SemiBold"
                                          Click="ExportInventory_Click"/>
                                    <Button x:Name="PrintInventoryBtn" Content="🖨️ Print Report" 
                                          Background="#6c757d" Foreground="White" BorderThickness="0" 
                                          Padding="15,10" FontWeight="SemiBold"
                                          Click="PrintVesselAccount_Click"/>
                                </StackPanel>
                            </Grid>
                        </Border>

                        <!-- Summary Cards -->
                        <Border Grid.Row="1" Background="#e8f5e8" BorderBrush="#4caf50" BorderThickness="1" 
                                CornerRadius="8" Padding="20" Margin="0,0,0,20">
                            <Grid>
                                <Grid.ColumnDefinitions>
                                    <ColumnDefinition Width="*"/>
                                    <ColumnDefinition Width="*"/>
                                    <ColumnDefinition Width="*"/>
                                    <ColumnDefinition Width="*"/>
                                    <ColumnDefinition Width="*"/>
                                </Grid.ColumnDefinitions>

                                <StackPanel Grid.Column="0" HorizontalAlignment="Center">
                                    <TextBlock Text="📦 Total Inventory (L)" FontWeight="SemiBold" HorizontalAlignment="Center" FontSize="12"/>
                                    <TextBlock x:Name="InventoryTotalLitersText" Text="0.000 L" FontSize="16" FontWeight="Bold" 
                                                HorizontalAlignment="Center" Foreground="#2e7d32"/>
                                </StackPanel>

                                <StackPanel Grid.Column="1" HorizontalAlignment="Center">
                                    <TextBlock Text="⚖️ Total Inventory (T)" FontWeight="SemiBold" HorizontalAlignment="Center" FontSize="12"/>
                                    <TextBlock x:Name="InventoryTotalTonsText" Text="0.000 T" FontSize="16" FontWeight="Bold" 
                                                HorizontalAlignment="Center" Foreground="#2e7d32"/>
                                </StackPanel>

                                <StackPanel Grid.Column="2" HorizontalAlignment="Center">
                                    <TextBlock Text="💰 FIFO Value" FontWeight="SemiBold" HorizontalAlignment="Center" FontSize="12"/>
                                    <TextBlock x:Name="InventoryTotalFIFOValueText" Text="$0.00" FontSize="16" FontWeight="Bold" 
                                                HorizontalAlignment="Center" Foreground="#2e7d32"/>
                                </StackPanel>

                                <StackPanel Grid.Column="3" HorizontalAlignment="Center">
                                    <TextBlock Text="📄 Purchase Lots" FontWeight="SemiBold" HorizontalAlignment="Center" FontSize="12"/>
                                    <TextBlock x:Name="InventoryPurchaseLotsText" Text="0" FontSize="16" FontWeight="Bold" 
                                                HorizontalAlignment="Center" Foreground="#2e7d32"/>
                                </StackPanel>

                                <StackPanel Grid.Column="4" HorizontalAlignment="Center">
                                    <TextBlock Text="💲 Avg Cost/Liter" FontWeight="SemiBold" HorizontalAlignment="Center" FontSize="12"/>
                                    <TextBlock x:Name="InventoryAvgCostPerLiterText" Text="$0.000000" FontSize="16" FontWeight="Bold" 
                                                HorizontalAlignment="Center" Foreground="#2e7d32"/>
                                </StackPanel>
                            </Grid>
                        </Border>

                        <!-- Inventory Tabs -->
                        <TabControl Grid.Row="2" x:Name="InventoryTabControl">

                            <!-- Inventory by Vessel Tab -->
                            <TabItem Header="🚢 By Vessel">
                                <StackPanel Margin="20">
                                    <TextBlock Text="Current Inventory by Vessel (FIFO Valuation)" FontSize="16" FontWeight="SemiBold" 
                                            Margin="0,0,0,15" Foreground="#2c3e50"/>

                                    <DataGrid x:Name="VesselInventoryGrid" 
                                            AutoGenerateColumns="False" 
                                            CanUserAddRows="False"
                                            CanUserDeleteRows="False"
                                            GridLinesVisibility="Horizontal"
                                            HeadersVisibility="Column"
                                            Background="White"
                                            BorderThickness="1"
                                            BorderBrush="#dee2e6"
                                            MaxHeight="500">

                                        <DataGrid.Columns>
                                            <DataGridTextColumn Header="Vessel" Binding="{Binding VesselName}" Width="120"/>
                                            <DataGridTextColumn Header="Type" Binding="{Binding VesselType}" Width="80"/>
                                            <DataGridTextColumn Header="Route" Binding="{Binding Route}" Width="180"/>
                                            <DataGridTextColumn Header="Inventory (L)" Binding="{Binding CurrentInventoryL, StringFormat=N3}" Width="120"/>
                                            <DataGridTextColumn Header="Inventory (T)" Binding="{Binding CurrentInventoryT, StringFormat=N3}" Width="120"/>
                                            <DataGridTextColumn Header="FIFO Value" Binding="{Binding FIFOValueUSD, StringFormat=C2}" Width="120"/>
                                            <DataGridTextColumn Header="Cost/L USD" Binding="{Binding AvgCostPerLiterUSD, StringFormat=C6}" Width="120"/>
                                            <DataGridTextColumn Header="Cost/T USD" Binding="{Binding AvgCostPerTonUSD, StringFormat=C2}" Width="120"/>
                                            <DataGridTextColumn Header="Lots" Binding="{Binding PurchaseLotsCount}" Width="60"/>
                                            <DataGridTextColumn Header="Oldest Date" Binding="{Binding FormattedOldestDate}" Width="100"/>
                                            <DataGridTextColumn Header="Days Old" Binding="{Binding DaysOldestInventory}" Width="80"/>
                                        </DataGrid.Columns>
                                    </DataGrid>
                                </StackPanel>
                            </TabItem>

                            <!-- Inventory by Supplier Tab -->
                            <TabItem Header="🏢 By Supplier">
                                <StackPanel Margin="20">
                                    <TextBlock Text="Current Inventory by Supplier (FIFO Valuation)" FontSize="16" FontWeight="SemiBold" 
                                            Margin="0,0,0,15" Foreground="#2c3e50"/>

                                    <DataGrid x:Name="SupplierInventoryGrid" 
                                            AutoGenerateColumns="False" 
                                            CanUserAddRows="False"
                                            CanUserDeleteRows="False"
                                            GridLinesVisibility="Horizontal"
                                            HeadersVisibility="Column"
                                            Background="White"
                                            BorderThickness="1"
                                            BorderBrush="#dee2e6"
                                            MaxHeight="500">

                                        <DataGrid.Columns>
                                            <DataGridTextColumn Header="Supplier" Binding="{Binding SupplierName}" Width="120"/>
                                            <DataGridTextColumn Header="Currency" Binding="{Binding Currency}" Width="80"/>
                                            <DataGridTextColumn Header="Inventory (L)" Binding="{Binding RemainingInventoryL, StringFormat=N3}" Width="120"/>
                                            <DataGridTextColumn Header="Inventory (T)" Binding="{Binding RemainingInventoryT, StringFormat=N3}" Width="120"/>
                                            <DataGridTextColumn Header="FIFO Value" Binding="{Binding FormattedFIFOValueOriginal}" Width="120"/>
                                            <DataGridTextColumn Header="USD Value" Binding="{Binding FIFOValueUSD, StringFormat=C2}" Width="100"/>
                                            <DataGridTextColumn Header="Cost/L" Binding="{Binding FormattedAvgCostOriginal}" Width="120"/>
                                            <DataGridTextColumn Header="Cost/L USD" Binding="{Binding AvgCostPerLiterUSD, StringFormat=C6}" Width="120"/>
                                            <DataGridTextColumn Header="Lots" Binding="{Binding PurchaseLotsCount}" Width="60"/>
                                            <DataGridTextColumn Header="Vessels" Binding="{Binding VesselsSupplied}" Width="70"/>
                                        </DataGrid.Columns>
                                    </DataGrid>
                                </StackPanel>
                            </TabItem>

                            <!-- Purchase Lot Details Tab -->
                            <TabItem Header="📄 Purchase Lots">
                                <StackPanel Margin="20">
                                    <TextBlock Text="Individual Purchase Lots (FIFO Order)" FontSize="16" FontWeight="SemiBold" 
                                            Margin="0,0,0,15" Foreground="#2c3e50"/>

                                    <DataGrid x:Name="PurchaseLotsGrid" 
                                            AutoGenerateColumns="False" 
                                            CanUserAddRows="False"
                                            CanUserDeleteRows="False"
                                            GridLinesVisibility="Horizontal"
                                            HeadersVisibility="Column"
                                            Background="White"
                                            BorderThickness="1"
                                            BorderBrush="#dee2e6"
                                            MaxHeight="500">

                                        <DataGrid.Columns>
                                            <DataGridTextColumn Header="Purchase Date" Binding="{Binding FormattedPurchaseDate}" Width="100"/>
                                            <DataGridTextColumn Header="Invoice Ref" Binding="{Binding InvoiceReference}" Width="100"/>
                                            <DataGridTextColumn Header="Vessel" Binding="{Binding VesselName}" Width="100"/>
                                            <DataGridTextColumn Header="Supplier" Binding="{Binding SupplierName}" Width="100"/>
                                            <DataGridTextColumn Header="Original (L)" Binding="{Binding OriginalQuantityL, StringFormat=N3}" Width="100"/>
                                            <DataGridTextColumn Header="Remaining (L)" Binding="{Binding RemainingQuantityL, StringFormat=N3}" Width="110"/>
                                            <DataGridTextColumn Header="Remaining (T)" Binding="{Binding RemainingQuantityT, StringFormat=N3}" Width="110"/>
                                            <DataGridTextColumn Header="% Remaining" Binding="{Binding PercentageRemaining, StringFormat=N1}" Width="100"/>
                                            <DataGridTextColumn Header="FIFO Value" Binding="{Binding FormattedRemainingValue}" Width="120"/>
                                            <DataGridTextColumn Header="USD Value" Binding="{Binding RemainingValueUSD, StringFormat=C2}" Width="100"/>
                                            <DataGridTextColumn Header="Cost/L" Binding="{Binding FormattedCostPerLiter}" Width="120"/>
                                            <DataGridTextColumn Header="Days in Inventory" Binding="{Binding DaysInInventory}" Width="120"/>
                                            <DataGridTextColumn Header="Aging" Binding="{Binding AgingCategory}" Width="120"/>
                                        </DataGrid.Columns>
                                    </DataGrid>
                                </StackPanel>
                            </TabItem>
                        </TabControl>
                    </Grid>
                </TabItem>

                <!-- Fleet Efficiency Analysis Tab -->
                <TabItem Header="🚢 Fleet Efficiency">
                    <ScrollViewer VerticalScrollBarVisibility="Auto">
                        <Grid Margin="20">
                            <Grid.RowDefinitions>
                                <RowDefinition Height="Auto"/>
                                <!-- Controls -->
                                <RowDefinition Height="*"/>
                                <!-- Content -->
                            </Grid.RowDefinitions>

                            <!-- Controls -->
                            <Border Grid.Row="0" Background="#f8f9fa" BorderBrush="#dee2e6" BorderThickness="1" 
                                    CornerRadius="8" Padding="20" Margin="0,0,0,20">
                                <Grid>
                                    <Grid.ColumnDefinitions>
                                        <ColumnDefinition Width="*"/>
                                        <ColumnDefinition Width="Auto"/>
                                    </Grid.ColumnDefinitions>

                                    <StackPanel Grid.Column="0" Orientation="Horizontal">
                                        <Button x:Name="GenerateFleetEfficiencyBtn" Content="🚢 Generate Fleet Analysis" 
                                                  Background="#007bff" Foreground="White" BorderThickness="0" 
                                                  Padding="15,10" FontWeight="SemiBold"
                                                  Click="GenerateFleetEfficiency_Click"/>

                                        <TextBlock Text="Comprehensive fleet performance analysis" 
                                                    VerticalAlignment="Center" Margin="20,0,0,0" 
                                                    FontStyle="Italic" Foreground="Gray"/>

                                        <Border Margin="20,0,0,0" Background="#e3f2fd" BorderBrush="#1976d2" BorderThickness="1" 
                                                CornerRadius="4" Padding="10,5">
                                            <StackPanel Orientation="Horizontal">
                                                <TextBlock Text="📅 Period:" FontWeight="SemiBold" VerticalAlignment="Center" Margin="0,0,10,0"/>
                                                <DatePicker x:Name="FleetFromDatePicker" SelectedDate="{x:Static sys:DateTime.Today}" 
                                                            Margin="0,0,10,0" FirstDayOfWeek="Sunday"/>
                                                <TextBlock Text="to" VerticalAlignment="Center" Margin="0,0,10,0"/>
                                                <DatePicker x:Name="FleetToDatePicker" SelectedDate="{x:Static sys:DateTime.Today}" 
                                                            FirstDayOfWeek="Sunday"/>
                                            </StackPanel>
                                        </Border>
                                    </StackPanel>

                                    <StackPanel Grid.Column="1" Orientation="Horizontal">
                                        <Button x:Name="ExportFleetEfficiencyBtn" Content="📤 Export" 
                                                  Background="#28a745" Foreground="White" BorderThickness="0" 
                                                  Padding="15,10" Margin="0,0,10,0" FontWeight="SemiBold"
                                                  Click="ExportFleetEfficiency_Click"/>
                                        <Button x:Name="PrintFleetEfficiencyBtn" Content="🖨️ Print Report" 
                                                  Background="#6c757d" Foreground="White" BorderThickness="0" 
                                                  Padding="15,10" FontWeight="SemiBold"
                                                  Click="PrintVesselAccount_Click"/>
                                    </StackPanel>
                                </Grid>
                            </Border>

                            <!-- Fleet Efficiency Tabs -->
                            <TabControl Grid.Row="1" x:Name="FleetEfficiencyTabControl">

                                <!-- Fleet Overview Tab -->
                                <TabItem Header="📊 Fleet Overview">
                                    <ScrollViewer VerticalScrollBarVisibility="Auto">
                                        <StackPanel Margin="20">
                                            <TextBlock Text="Fleet Performance Overview" FontSize="16" FontWeight="SemiBold" 
                                                        Margin="0,0,0,15" Foreground="#2c3e50"/>

                                            <!-- Summary Cards -->
                                            <Border Background="#e8f5e8" BorderBrush="#4caf50" BorderThickness="1" 
                                                    CornerRadius="8" Padding="20" Margin="0,0,0,20">
                                                <Grid>
                                                    <Grid.ColumnDefinitions>
                                                        <ColumnDefinition Width="*"/>
                                                        <ColumnDefinition Width="*"/>
                                                        <ColumnDefinition Width="*"/>
                                                        <ColumnDefinition Width="*"/>
                                                        <ColumnDefinition Width="*"/>
                                                    </Grid.ColumnDefinitions>

                                                    <StackPanel Grid.Column="0" HorizontalAlignment="Center">
                                                        <TextBlock Text="🚢 Active Vessels" FontWeight="SemiBold" HorizontalAlignment="Center" FontSize="12"/>
                                                        <TextBlock x:Name="FleetActiveVesselsText" Text="0" FontSize="16" FontWeight="Bold" 
                                                                    HorizontalAlignment="Center" Foreground="#2e7d32"/>
                                                    </StackPanel>

                                                    <StackPanel Grid.Column="1" HorizontalAlignment="Center">
                                                        <TextBlock Text="📍 Total Legs" FontWeight="SemiBold" HorizontalAlignment="Center" FontSize="12"/>
                                                        <TextBlock x:Name="FleetTotalLegsText" Text="0" FontSize="16" FontWeight="Bold" 
                                                                    HorizontalAlignment="Center" Foreground="#2e7d32"/>
                                                    </StackPanel>

                                                    <StackPanel Grid.Column="2" HorizontalAlignment="Center">
                                                        <TextBlock Text="⛽ Avg L/Leg" FontWeight="SemiBold" HorizontalAlignment="Center" FontSize="12"/>
                                                        <TextBlock x:Name="FleetAvgEfficiencyLText" Text="0.000" FontSize="16" FontWeight="Bold" 
                                                                    HorizontalAlignment="Center" Foreground="#2e7d32"/>
                                                    </StackPanel>

                                                    <StackPanel Grid.Column="3" HorizontalAlignment="Center">
                                                        <TextBlock Text="💰 Avg Cost/Leg" FontWeight="SemiBold" HorizontalAlignment="Center" FontSize="12"/>
                                                        <TextBlock x:Name="FleetAvgCostPerLegText" Text="$0.00" FontSize="16" FontWeight="Bold" 
                                                                    HorizontalAlignment="Center" Foreground="#2e7d32"/>
                                                    </StackPanel>

                                                    <StackPanel Grid.Column="4" HorizontalAlignment="Center">
                                                        <TextBlock Text="💲 Total Fleet Cost" FontWeight="SemiBold" HorizontalAlignment="Center" FontSize="12"/>
                                                        <TextBlock x:Name="FleetTotalCostText" Text="$0.00" FontSize="16" FontWeight="Bold" 
                                                                    HorizontalAlignment="Center" Foreground="#2e7d32"/>
                                                    </StackPanel>
                                                </Grid>
                                            </Border>

                                            <!-- Best Performers Cards -->
                                            <Border Background="#fff3cd" BorderBrush="#ffc107" BorderThickness="1" 
                                                    CornerRadius="8" Padding="20" Margin="0,0,0,20">
                                                <Grid>
                                                    <Grid.ColumnDefinitions>
                                                        <ColumnDefinition Width="*"/>
                                                        <ColumnDefinition Width="*"/>
                                                        <ColumnDefinition Width="*"/>
                                                    </Grid.ColumnDefinitions>

                                                    <StackPanel Grid.Column="0" HorizontalAlignment="Center">
                                                        <TextBlock Text="🏆 Most Efficient Vessel" FontWeight="SemiBold" HorizontalAlignment="Center" FontSize="12"/>
                                                        <TextBlock x:Name="FleetBestVesselText" Text="N/A" FontSize="14" FontWeight="Bold" 
                                                                    HorizontalAlignment="Center" Foreground="#f57c00"/>
                                                    </StackPanel>

                                                    <StackPanel Grid.Column="1" HorizontalAlignment="Center">
                                                        <TextBlock Text="🎯 Best Route" FontWeight="SemiBold" HorizontalAlignment="Center" FontSize="12"/>
                                                        <TextBlock x:Name="FleetBestRouteText" Text="N/A" FontSize="14" FontWeight="Bold" 
                                                                    HorizontalAlignment="Center" Foreground="#f57c00"/>
                                                    </StackPanel>

                                                    <StackPanel Grid.Column="2" HorizontalAlignment="Center">
                                                        <TextBlock Text="📉 Best Route Efficiency" FontWeight="SemiBold" HorizontalAlignment="Center" FontSize="12"/>
                                                        <TextBlock x:Name="FleetBestRouteEfficiencyText" Text="0.000 L/Leg" FontSize="14" FontWeight="Bold" 
                                                                    HorizontalAlignment="Center" Foreground="#f57c00"/>
                                                    </StackPanel>
                                                </Grid>
                                            </Border>
                                        </StackPanel>
                                    </ScrollViewer>
                                </TabItem>

                                <!-- Vessel Performance Tab -->
                                <TabItem Header="🚢 Vessel Performance">
                                    <StackPanel Margin="20">
                                        <TextBlock Text="Individual Vessel Performance Analysis" FontSize="16" FontWeight="SemiBold" 
                                                    Margin="0,0,0,15" Foreground="#2c3e50"/>

                                        <DataGrid x:Name="VesselPerformanceGrid" 
                                                  AutoGenerateColumns="False" 
                                                  CanUserAddRows="False"
                                                  CanUserDeleteRows="False"
                                                  GridLinesVisibility="Horizontal"
                                                  HeadersVisibility="Column"
                                                  Background="White"
                                                  BorderThickness="1"
                                                  BorderBrush="#dee2e6"
                                                  MaxHeight="600">

                                            <DataGrid.Columns>
                                                <DataGridTextColumn Header="Vessel" Binding="{Binding VesselName}" Width="120"/>
                                                <DataGridTextColumn Header="Type" Binding="{Binding VesselType}" Width="80"/>
                                                <DataGridTextColumn Header="Route" Binding="{Binding Route}" Width="180"/>
                                                <DataGridTextColumn Header="Efficiency L/Leg" Binding="{Binding EfficiencyLPerLeg, StringFormat=N3}" Width="120"/>
                                                <DataGridTextColumn Header="Efficiency T/Leg" Binding="{Binding EfficiencyTPerLeg, StringFormat=N3}" Width="120"/>
                                                <DataGridTextColumn Header="Cost/Leg" Binding="{Binding FormattedCostPerLeg}" Width="120"/>
                                                <DataGridTextColumn Header="Cost/Liter" Binding="{Binding CostPerLiterUSD, StringFormat=C6}" Width="120"/>
                                                <DataGridTextColumn Header="Total Legs" Binding="{Binding TotalLegs}" Width="100"/>
                                                <DataGridTextColumn Header="Total Cost" Binding="{Binding FormattedTotalCost}" Width="120"/>
                                                <DataGridTextColumn Header="Rank" Binding="{Binding EfficiencyRank}" Width="80"/>
                                                <DataGridTextColumn Header="Grade" Binding="{Binding EfficiencyGrade}" Width="100"/>
                                                <DataGridTextColumn Header="Months Active" Binding="{Binding MonthsActive}" Width="120"/>
                                            </DataGrid.Columns>
                                        </DataGrid>
                                    </StackPanel>
                                </TabItem>

                                <!-- Route Analysis Tab -->
                                <TabItem Header="🛣️ Route Analysis">
                                    <StackPanel Margin="20">
                                        <TextBlock Text="Route Performance Comparison" FontSize="16" FontWeight="SemiBold" 
                                                    Margin="0,0,0,15" Foreground="#2c3e50"/>

                                        <DataGrid x:Name="RouteComparisonGrid" 
                                                  AutoGenerateColumns="False" 
                                                  CanUserAddRows="False"
                                                  CanUserDeleteRows="False"
                                                  GridLinesVisibility="Horizontal"
                                                  HeadersVisibility="Column"
                                                  Background="White"
                                                  BorderThickness="1"
                                                  BorderBrush="#dee2e6"
                                                  MaxHeight="600">

                                            <DataGrid.Columns>
                                                <DataGridTextColumn Header="Route Type" Binding="{Binding RouteType}" Width="120"/>
                                                <DataGridTextColumn Header="Route Name" Binding="{Binding RouteName}" Width="180"/>
                                                <DataGridTextColumn Header="Vessels" Binding="{Binding VesselCount}" Width="80"/>
                                                <DataGridTextColumn Header="Avg L/Leg" Binding="{Binding AvgEfficiencyLPerLeg, StringFormat=N3}" Width="120"/>
                                                <DataGridTextColumn Header="Avg T/Leg" Binding="{Binding AvgEfficiencyTPerLeg, StringFormat=N3}" Width="120"/>
                                                <DataGridTextColumn Header="Avg Cost/Leg" Binding="{Binding FormattedAvgCostPerLeg}" Width="120"/>
                                                <DataGridTextColumn Header="Total Legs" Binding="{Binding TotalLegs}" Width="100"/>
                                                <DataGridTextColumn Header="Total Cost" Binding="{Binding FormattedTotalCost}" Width="120"/>
                                                <DataGridTextColumn Header="Best Vessel" Binding="{Binding BestVesselName}" Width="120"/>
                                                <DataGridTextColumn Header="Best Efficiency" Binding="{Binding BestVesselEfficiencyL, StringFormat=N3}" Width="120"/>
                                                <DataGridTextColumn Header="Efficiency Range" Binding="{Binding EfficiencyVariance, StringFormat=N3}" Width="120"/>
                                            </DataGrid.Columns>
                                        </DataGrid>
                                    </StackPanel>
                                </TabItem>

                                <!-- Performance Trends Tab -->
                                <TabItem Header="📈 Performance Trends">
                                    <StackPanel Margin="20">
                                        <TextBlock Text="Monthly Fleet Performance Trends" FontSize="16" FontWeight="SemiBold" 
                                                    Margin="0,0,0,15" Foreground="#2c3e50"/>

                                        <DataGrid x:Name="MonthlyTrendsGrid" 
                                                  AutoGenerateColumns="False" 
                                                  CanUserAddRows="False"
                                                  CanUserDeleteRows="False"
                                                  GridLinesVisibility="Horizontal"
                                                  HeadersVisibility="Column"
                                                  Background="White"
                                                  BorderThickness="1"
                                                  BorderBrush="#dee2e6"
                                                  MaxHeight="600">

                                            <DataGrid.Columns>
                                                <DataGridTextColumn Header="Month" Binding="{Binding Month}" Width="100"/>
                                                <DataGridTextColumn Header="Fleet L/Leg" Binding="{Binding FleetAvgEfficiencyL, StringFormat=N3}" Width="120"/>
                                                <DataGridTextColumn Header="Fleet T/Leg" Binding="{Binding FleetAvgEfficiencyT, StringFormat=N3}" Width="120"/>
                                                <DataGridTextColumn Header="Avg Cost/Leg" Binding="{Binding FormattedFleetCostPerLeg}" Width="120"/>
                                                <DataGridTextColumn Header="Total Legs" Binding="{Binding TotalLegs}" Width="100"/>
                                                <DataGridTextColumn Header="Active Vessels" Binding="{Binding ActiveVessels}" Width="120"/>
                                                <DataGridTextColumn Header="Total Cost" Binding="{Binding FormattedTotalCost}" Width="120"/>
                                                <DataGridTextColumn Header="L/Leg Change" Binding="{Binding FormattedMoMChangeL}" Width="120"/>
                                                <DataGridTextColumn Header="T/Leg Change" Binding="{Binding FormattedMoMChangeT}" Width="120"/>
                                                <DataGridTextColumn Header="Cost Change" Binding="{Binding FormattedCostChange}" Width="120"/>
                                            </DataGrid.Columns>
                                        </DataGrid>
                                    </StackPanel>
                                </TabItem>

                                <!-- Efficiency Rankings Tab -->
                                <TabItem Header="🏆 Rankings">
                                    <StackPanel Margin="20">
                                        <TextBlock Text="Fleet Efficiency Rankings" FontSize="16" FontWeight="SemiBold" 
                                                    Margin="0,0,0,15" Foreground="#2c3e50"/>

                                        <DataGrid x:Name="EfficiencyRankingsGrid" 
                                                  AutoGenerateColumns="False" 
                                                  CanUserAddRows="False"
                                                  CanUserDeleteRows="False"
                                                  GridLinesVisibility="Horizontal"
                                                  HeadersVisibility="Column"
                                                  Background="White"
                                                  BorderThickness="1"
                                                  BorderBrush="#dee2e6"
                                                  MaxHeight="600">

                                            <DataGrid.Columns>
                                                <DataGridTextColumn Header="Rank" Binding="{Binding Rank}" Width="60"/>
                                                <DataGridTextColumn Header="Vessel" Binding="{Binding VesselName}" Width="120"/>
                                                <DataGridTextColumn Header="Type" Binding="{Binding VesselType}" Width="80"/>
                                                <DataGridTextColumn Header="Route" Binding="{Binding Route}" Width="160"/>
                                                <DataGridTextColumn Header="L/Leg" Binding="{Binding EfficiencyLPerLeg, StringFormat=N3}" Width="100"/>
                                                <DataGridTextColumn Header="T/Leg" Binding="{Binding EfficiencyTPerLeg, StringFormat=N3}" Width="100"/>
                                                <DataGridTextColumn Header="Cost/Leg" Binding="{Binding FormattedCostPerLeg}" Width="120"/>
                                                <DataGridTextColumn Header="Performance" Binding="{Binding PerformanceCategory}" Width="120"/>
                                                <DataGridTextColumn Header="vs Fleet Avg" Binding="{Binding FormattedBenchmarkDiff}" Width="120"/>
                                                <DataGridTextColumn Header="Trend" Binding="{Binding TrendDirection}" Width="100"/>
                                                <DataGridTextColumn Header="Score" Binding="{Binding OverallEfficiencyScore, StringFormat=N1}" Width="80"/>
                                            </DataGrid.Columns>
                                        </DataGrid>
                                    </StackPanel>
                                </TabItem>

                                <!-- Cost Analysis Tab -->
                                <TabItem Header="💰 Cost Analysis">
                                    <StackPanel Margin="20">
                                        <TextBlock Text="FIFO Cost Efficiency Analysis" FontSize="16" FontWeight="SemiBold" 
                                                    Margin="0,0,0,15" Foreground="#2c3e50"/>

                                        <DataGrid x:Name="CostEfficiencyGrid" 
                                                  AutoGenerateColumns="False" 
                                                  CanUserAddRows="False"
                                                  CanUserDeleteRows="False"
                                                  GridLinesVisibility="Horizontal"
                                                  HeadersVisibility="Column"
                                                  Background="White"
                                                  BorderThickness="1"
                                                  BorderBrush="#dee2e6"
                                                  MaxHeight="600">

                                            <DataGrid.Columns>
                                                <DataGridTextColumn Header="Vessel" Binding="{Binding VesselName}" Width="120"/>
                                                <DataGridTextColumn Header="Type" Binding="{Binding VesselType}" Width="80"/>
                                                <DataGridTextColumn Header="Total FIFO Cost" Binding="{Binding FormattedTotalFIFOCost}" Width="140"/>
                                                <DataGridTextColumn Header="Cost/Liter" Binding="{Binding CostPerLiterFIFO, StringFormat=C6}" Width="120"/>
                                                <DataGridTextColumn Header="Cost/Ton" Binding="{Binding CostPerTonFIFO, StringFormat=C2}" Width="120"/>
                                                <DataGridTextColumn Header="Cost/Leg" Binding="{Binding FormattedCostPerLeg}" Width="120"/>
                                                <DataGridTextColumn Header="Avg Fuel Price" Binding="{Binding FormattedAvgFuelPrice}" Width="120"/>
                                                <DataGridTextColumn Header="Suppliers" Binding="{Binding NumberOfSuppliers}" Width="100"/>
                                                <DataGridTextColumn Header="Procurement Eff" Binding="{Binding FormattedProcurementEff}" Width="140"/>
                                                <DataGridTextColumn Header="Cost Rank" Binding="{Binding CostEfficiencyRank}" Width="100"/>
                                            </DataGrid.Columns>
                                        </DataGrid>
                                    </StackPanel>
                                </TabItem>

                                <!-- Seasonal Patterns Tab -->
                                <TabItem Header="🌍 Seasonal Patterns">
                                    <StackPanel Margin="20">
                                        <TextBlock Text="Seasonal Efficiency Patterns" FontSize="16" FontWeight="SemiBold" 
                                                    Margin="0,0,0,15" Foreground="#2c3e50"/>

                                        <DataGrid x:Name="SeasonalPatternsGrid" 
                                                  AutoGenerateColumns="False" 
                                                  CanUserAddRows="False"
                                                  CanUserDeleteRows="False"
                                                  GridLinesVisibility="Horizontal"
                                                  HeadersVisibility="Column"
                                                  Background="White"
                                                  BorderThickness="1"
                                                  BorderBrush="#dee2e6"
                                                  MaxHeight="600">

                                            <DataGrid.Columns>
                                                <DataGridTextColumn Header="Season" Binding="{Binding SeasonName}" Width="100"/>
                                                <DataGridTextColumn Header="Quarter" Binding="{Binding Season}" Width="80"/>
                                                <DataGridTextColumn Header="Avg L/Leg" Binding="{Binding AvgEfficiencyL, StringFormat=N3}" Width="120"/>
                                                <DataGridTextColumn Header="Avg T/Leg" Binding="{Binding AvgEfficiencyT, StringFormat=N3}" Width="120"/>
                                                <DataGridTextColumn Header="Avg Cost/Leg" Binding="{Binding FormattedAvgCostPerLeg}" Width="120"/>
                                                <DataGridTextColumn Header="Seasonal Variance" Binding="{Binding SeasonalVariance, StringFormat=N3}" Width="140"/>
                                                <DataGridTextColumn Header="Data Points" Binding="{Binding DataPoints}" Width="120"/>
                                                <DataGridTextColumn Header="YoY Change" Binding="{Binding FormattedYoYChange}" Width="120"/>
                                                <DataGridTextColumn Header="Weather Impact" Binding="{Binding WeatherImpact}" Width="140"/>
                                                <DataGridTextColumn Header="Capacity Util" Binding="{Binding CapacityUtilization, StringFormat=N1}" Width="120"/>
                                            </DataGrid.Columns>
                                        </DataGrid>
                                    </StackPanel>
                                </TabItem>

                            </TabControl>
                        </Grid>
                    </ScrollViewer>
                </TabItem>

                <!-- FIFO Allocation Detail Report Tab -->
                <TabItem Header="🔍 FIFO Allocation Detail">
                    <ScrollViewer VerticalScrollBarVisibility="Auto">
                        <Grid Margin="20">
                            <Grid.RowDefinitions>
                                <RowDefinition Height="Auto"/>
                                <!-- Controls -->
                                <RowDefinition Height="*"/>
                                <!-- Content -->
                            </Grid.RowDefinitions>

                            <!-- Controls -->
                            <Border Grid.Row="0" Background="#f8f9fa" BorderBrush="#dee2e6" BorderThickness="1" 
                    CornerRadius="8" Padding="20" Margin="0,0,0,20">
                                <Grid>
                                    <Grid.ColumnDefinitions>
                                        <ColumnDefinition Width="*"/>
                                        <ColumnDefinition Width="Auto"/>
                                    </Grid.ColumnDefinitions>

                                    <StackPanel Grid.Column="0" Orientation="Horizontal">
                                        <Button x:Name="GenerateFIFODetailBtn" Content="🔍 Generate FIFO Detail Report" 
                              Background="#007bff" Foreground="White" BorderThickness="0" 
                              Padding="15,10" FontWeight="SemiBold"
                              Click="GenerateFIFODetail_Click"/>

                                        <TextBlock Text="Complete FIFO allocation audit trail and analysis" 
                            VerticalAlignment="Center" Margin="20,0,0,0" 
                            FontStyle="Italic" Foreground="Gray"/>

                                        <Border Margin="20,0,0,0" Background="#e3f2fd" BorderBrush="#1976d2" BorderThickness="1" 
                                CornerRadius="4" Padding="10,5">
                                            <StackPanel Orientation="Horizontal">
                                                <TextBlock Text="📅 Period:" FontWeight="SemiBold" VerticalAlignment="Center" Margin="0,0,10,0"/>
                                                <DatePicker x:Name="FIFOFromDatePicker" SelectedDate="{x:Static sys:DateTime.Today}" 
                                           Margin="0,0,10,0" FirstDayOfWeek="Sunday"/>
                                                <TextBlock Text="to" VerticalAlignment="Center" Margin="0,0,10,0"/>
                                                <DatePicker x:Name="FIFOToDatePicker" SelectedDate="{x:Static sys:DateTime.Today}" 
                                           FirstDayOfWeek="Sunday"/>
                                            </StackPanel>
                                        </Border>
                                    </StackPanel>

                                    <StackPanel Grid.Column="1" Orientation="Horizontal">
                                        <Button x:Name="ExportFIFODetailBtn" Content="📤 Export" 
                              Background="#28a745" Foreground="White" BorderThickness="0" 
                              Padding="15,10" Margin="0,0,10,0" FontWeight="SemiBold"
                              Click="ExportFIFODetail_Click"/>
                                        <Button x:Name="PrintFIFODetailBtn" Content="🖨️ Print Report" 
                              Background="#6c757d" Foreground="White" BorderThickness="0" 
                              Padding="15,10" FontWeight="SemiBold"
                              Click="PrintVesselAccount_Click"/>
                                    </StackPanel>
                                </Grid>
                            </Border>

                            <!-- FIFO Detail Tabs -->
                            <TabControl Grid.Row="1" x:Name="FIFODetailTabControl">

                                <!-- Allocation Flow Summary Tab -->
                                <TabItem Header="📊 Allocation Flow">
                                    <ScrollViewer VerticalScrollBarVisibility="Auto">
                                        <StackPanel Margin="20">
                                            <TextBlock Text="FIFO Allocation Flow Summary" FontSize="16" FontWeight="SemiBold" 
                                    Margin="0,0,0,15" Foreground="#2c3e50"/>

                                            <!-- Flow Summary Cards -->
                                            <Border Background="#e8f5e8" BorderBrush="#4caf50" BorderThickness="1" 
                                    CornerRadius="8" Padding="20" Margin="0,0,0,20">
                                                <Grid>
                                                    <Grid.ColumnDefinitions>
                                                        <ColumnDefinition Width="*"/>
                                                        <ColumnDefinition Width="*"/>
                                                        <ColumnDefinition Width="*"/>
                                                        <ColumnDefinition Width="*"/>
                                                        <ColumnDefinition Width="*"/>
                                                    </Grid.ColumnDefinitions>

                                                    <StackPanel Grid.Column="0" HorizontalAlignment="Center">
                                                        <TextBlock Text="📦 Total Purchases" FontWeight="SemiBold" HorizontalAlignment="Center" FontSize="12"/>
                                                        <TextBlock x:Name="FIFOTotalPurchasesText" Text="0.000 L" FontSize="16" FontWeight="Bold" 
                                                   HorizontalAlignment="Center" Foreground="#2e7d32"/>
                                                    </StackPanel>

                                                    <StackPanel Grid.Column="1" HorizontalAlignment="Center">
                                                        <TextBlock Text="⛽ Total Consumption" FontWeight="SemiBold" HorizontalAlignment="Center" FontSize="12"/>
                                                        <TextBlock x:Name="FIFOTotalConsumptionText" Text="0.000 L" FontSize="16" FontWeight="Bold" 
                                                   HorizontalAlignment="Center" Foreground="#2e7d32"/>
                                                    </StackPanel>

                                                    <StackPanel Grid.Column="2" HorizontalAlignment="Center">
                                                        <TextBlock Text="🔄 Total Allocated" FontWeight="SemiBold" HorizontalAlignment="Center" FontSize="12"/>
                                                        <TextBlock x:Name="FIFOTotalAllocatedText" Text="0.000 L" FontSize="16" FontWeight="Bold" 
                                                   HorizontalAlignment="Center" Foreground="#2e7d32"/>
                                                    </StackPanel>

                                                    <StackPanel Grid.Column="3" HorizontalAlignment="Center">
                                                        <TextBlock Text="💰 FIFO Value" FontWeight="SemiBold" HorizontalAlignment="Center" FontSize="12"/>
                                                        <TextBlock x:Name="FIFOTotalValueText" Text="$0.00" FontSize="16" FontWeight="Bold" 
                                                   HorizontalAlignment="Center" Foreground="#2e7d32"/>
                                                    </StackPanel>

                                                    <StackPanel Grid.Column="4" HorizontalAlignment="Center">
                                                        <TextBlock Text="📊 Accuracy" FontWeight="SemiBold" HorizontalAlignment="Center" FontSize="12"/>
                                                        <TextBlock x:Name="FIFOAccuracyText" Text="100.0%" FontSize="16" FontWeight="Bold" 
                                                   HorizontalAlignment="Center" Foreground="#2e7d32"/>
                                                    </StackPanel>
                                                </Grid>
                                            </Border>

                                            <!-- Activity Summary -->
                                            <Border Background="#fff3cd" BorderBrush="#ffc107" BorderThickness="1" 
                                    CornerRadius="8" Padding="20" Margin="0,0,0,20">
                                                <Grid>
                                                    <Grid.ColumnDefinitions>
                                                        <ColumnDefinition Width="*"/>
                                                        <ColumnDefinition Width="*"/>
                                                        <ColumnDefinition Width="*"/>
                                                        <ColumnDefinition Width="*"/>
                                                        <ColumnDefinition Width="*"/>
                                                    </Grid.ColumnDefinitions>

                                                    <StackPanel Grid.Column="0" HorizontalAlignment="Center">
                                                        <TextBlock Text="🔢 Transactions" FontWeight="SemiBold" HorizontalAlignment="Center" FontSize="12"/>
                                                        <TextBlock x:Name="FIFOTransactionsText" Text="0" FontSize="16" FontWeight="Bold" 
                                                   HorizontalAlignment="Center" Foreground="#f57c00"/>
                                                    </StackPanel>

                                                    <StackPanel Grid.Column="1" HorizontalAlignment="Center">
                                                        <TextBlock Text="📄 Purchase Lots" FontWeight="SemiBold" HorizontalAlignment="Center" FontSize="12"/>
                                                        <TextBlock x:Name="FIFOPurchaseLotsText" Text="0" FontSize="16" FontWeight="Bold" 
                                                   HorizontalAlignment="Center" Foreground="#f57c00"/>
                                                    </StackPanel>

                                                    <StackPanel Grid.Column="2" HorizontalAlignment="Center">
                                                        <TextBlock Text="🚢 Vessels" FontWeight="SemiBold" HorizontalAlignment="Center" FontSize="12"/>
                                                        <TextBlock x:Name="FIFOVesselsText" Text="0" FontSize="16" FontWeight="Bold" 
                                                   HorizontalAlignment="Center" Foreground="#f57c00"/>
                                                    </StackPanel>

                                                    <StackPanel Grid.Column="3" HorizontalAlignment="Center">
                                                        <TextBlock Text="🏢 Suppliers" FontWeight="SemiBold" HorizontalAlignment="Center" FontSize="12"/>
                                                        <TextBlock x:Name="FIFOSuppliersText" Text="0" FontSize="16" FontWeight="Bold" 
                                                   HorizontalAlignment="Center" Foreground="#f57c00"/>
                                                    </StackPanel>

                                                    <StackPanel Grid.Column="4" HorizontalAlignment="Center">
                                                        <TextBlock Text="📅 Date Range" FontWeight="SemiBold" HorizontalAlignment="Center" FontSize="12"/>
                                                        <TextBlock x:Name="FIFODateRangeText" Text="No Data" FontSize="14" FontWeight="Bold" 
                                                   HorizontalAlignment="Center" Foreground="#f57c00"/>
                                                    </StackPanel>
                                                </Grid>
                                            </Border>
                                        </StackPanel>
                                    </ScrollViewer>
                                </TabItem>

                                <!-- Allocation Records Tab -->
                                <TabItem Header="📋 Allocation Records">
                                    <StackPanel Margin="20">
                                        <TextBlock Text="Detailed FIFO Allocation Audit Trail" FontSize="16" FontWeight="SemiBold" 
                                Margin="0,0,0,15" Foreground="#2c3e50"/>

                                        <DataGrid x:Name="AllocationRecordsGrid" 
                                  AutoGenerateColumns="False" 
                                  CanUserAddRows="False"
                                  CanUserDeleteRows="False"
                                  GridLinesVisibility="Horizontal"
                                  HeadersVisibility="Column"
                                  Background="White"
                                  BorderThickness="1"
                                  BorderBrush="#dee2e6"
                                  MaxHeight="600">

                                            <DataGrid.Columns>
                                                <DataGridTextColumn Header="FIFO #" Binding="{Binding FIFOSequence}" Width="60"/>
                                                <DataGridTextColumn Header="Allocation Date" Binding="{Binding FormattedAllocationDate}" Width="100"/>
                                                <DataGridTextColumn Header="Invoice Ref" Binding="{Binding InvoiceReference}" Width="100"/>
                                                <DataGridTextColumn Header="Purchase Date" Binding="{Binding FormattedPurchaseDate}" Width="100"/>
                                                <DataGridTextColumn Header="Supplier" Binding="{Binding SupplierName}" Width="120"/>
                                                <DataGridTextColumn Header="P.Vessel" Binding="{Binding PurchaseVessel}" Width="80"/>
                                                <DataGridTextColumn Header="C.Vessel" Binding="{Binding ConsumptionVessel}" Width="80"/>
                                                <DataGridTextColumn Header="Consumption Date" Binding="{Binding FormattedConsumptionDate}" Width="120"/>
                                                <DataGridTextColumn Header="Allocated (L)" Binding="{Binding AllocatedQuantityL, StringFormat=N3}" Width="100"/>
                                                <DataGridTextColumn Header="Allocated (T)" Binding="{Binding AllocatedQuantityT, StringFormat=N3}" Width="100"/>
                                                <DataGridTextColumn Header="Allocated Value" Binding="{Binding FormattedAllocatedValue}" Width="120"/>
                                                <DataGridTextColumn Header="Balance After (L)" Binding="{Binding PurchaseBalanceAfterL, StringFormat=N3}" Width="120"/>
                                                <DataGridTextColumn Header="Price/L" Binding="{Binding FormattedPricePerLiter}" Width="100"/>
                                                <DataGridTextColumn Header="% of Purchase" Binding="{Binding AllocationPercentageOfPurchase, StringFormat=N1}" Width="100"/>
                                                <DataGridTextColumn Header="Status" Binding="{Binding AllocationStatus}" Width="80"/>
                                                <DataGridTextColumn Header="Vessel Match" Binding="{Binding VesselMatchStatus}" Width="100"/>
                                            </DataGrid.Columns>
                                        </DataGrid>
                                    </StackPanel>
                                </TabItem>

                                <!-- Purchase Lot Tracking Tab -->
                                <TabItem Header="📦 Purchase Lot Tracking">
                                    <StackPanel Margin="20">
                                        <TextBlock Text="Purchase Lot Consumption Tracking" FontSize="16" FontWeight="SemiBold" 
                                Margin="0,0,0,15" Foreground="#2c3e50"/>

                                        <DataGrid x:Name="PurchaseLotTrackingGrid" 
                                  AutoGenerateColumns="False" 
                                  CanUserAddRows="False"
                                  CanUserDeleteRows="False"
                                  GridLinesVisibility="Horizontal"
                                  HeadersVisibility="Column"
                                  Background="White"
                                  BorderThickness="1"
                                  BorderBrush="#dee2e6"
                                  MaxHeight="600">

                                            <DataGrid.Columns>
                                                <DataGridTextColumn Header="Invoice Ref" Binding="{Binding InvoiceReference}" Width="100"/>
                                                <DataGridTextColumn Header="Purchase Date" Binding="{Binding FormattedPurchaseDate}" Width="100"/>
                                                <DataGridTextColumn Header="Supplier" Binding="{Binding SupplierName}" Width="120"/>
                                                <DataGridTextColumn Header="Vessel" Binding="{Binding VesselName}" Width="100"/>
                                                <DataGridTextColumn Header="Original (L)" Binding="{Binding OriginalQuantityL, StringFormat=N3}" Width="100"/>
                                                <DataGridTextColumn Header="Remaining (L)" Binding="{Binding RemainingQuantityL, StringFormat=N3}" Width="100"/>
                                                <DataGridTextColumn Header="Allocated (L)" Binding="{Binding TotalAllocatedL, StringFormat=N3}" Width="100"/>
                                                <DataGridTextColumn Header="Progress" Binding="{Binding FormattedConsumptionProgress}" Width="80"/>
                                                <DataGridTextColumn Header="Status" Binding="{Binding LotStatus}" Width="120"/>
                                                <DataGridTextColumn Header="Allocations" Binding="{Binding AllocationCount}" Width="80"/>
                                                <DataGridTextColumn Header="First Allocation" Binding="{Binding FormattedFirstAllocation}" Width="120"/>
                                                <DataGridTextColumn Header="Last Allocation" Binding="{Binding FormattedLastAllocation}" Width="120"/>
                                                <DataGridTextColumn Header="Days in Inventory" Binding="{Binding DaysInInventory}" Width="120"/>
                                                <DataGridTextColumn Header="Turnover Rate" Binding="{Binding InventoryTurnoverRate, StringFormat=N2}" Width="100"/>
                                                <DataGridTextColumn Header="Remaining Value" Binding="{Binding FormattedRemainingValue}" Width="120"/>
                                            </DataGrid.Columns>
                                        </DataGrid>
                                    </StackPanel>
                                </TabItem>

                                <!-- Balance Verification Tab -->
                                <TabItem Header="⚖️ Balance Verification">
                                    <ScrollViewer VerticalScrollBarVisibility="Auto">
                                        <StackPanel Margin="20">
                                            <TextBlock Text="FIFO Data Integrity and Balance Verification" FontSize="16" FontWeight="SemiBold" 
                                    Margin="0,0,0,15" Foreground="#2c3e50"/>

                                            <!-- Balance Status Card -->
                                            <Border Background="#d4edda" BorderBrush="#28a745" BorderThickness="1" 
                                    CornerRadius="8" Padding="20" Margin="0,0,0,20">
                                                <Grid>
                                                    <Grid.ColumnDefinitions>
                                                        <ColumnDefinition Width="*"/>
                                                        <ColumnDefinition Width="*"/>
                                                        <ColumnDefinition Width="*"/>
                                                        <ColumnDefinition Width="*"/>
                                                    </Grid.ColumnDefinitions>

                                                    <StackPanel Grid.Column="0" HorizontalAlignment="Center">
                                                        <TextBlock Text="⚖️ Balance Status" FontWeight="SemiBold" HorizontalAlignment="Center" FontSize="12"/>
                                                        <TextBlock x:Name="BalanceStatusText" Text="✅ Balanced" FontSize="16" FontWeight="Bold" 
                                                   HorizontalAlignment="Center" Foreground="#155724"/>
                                                    </StackPanel>

                                                    <StackPanel Grid.Column="1" HorizontalAlignment="Center">
                                                        <TextBlock Text="📊 Data Integrity" FontWeight="SemiBold" HorizontalAlignment="Center" FontSize="12"/>
                                                        <TextBlock x:Name="DataIntegrityScoreText" Text="100%" FontSize="16" FontWeight="Bold" 
                                                   HorizontalAlignment="Center" Foreground="#155724"/>
                                                    </StackPanel>

                                                    <StackPanel Grid.Column="2" HorizontalAlignment="Center">
                                                        <TextBlock Text="⚠️ Inconsistencies" FontWeight="SemiBold" HorizontalAlignment="Center" FontSize="12"/>
                                                        <TextBlock x:Name="InconsistenciesText" Text="0" FontSize="16" FontWeight="Bold" 
                                                                    HorizontalAlignment="Center" Foreground="#155724"/>
                                                    </StackPanel>

                                                    <StackPanel Grid.Column="3" HorizontalAlignment="Center">
                                                        <TextBlock Text="🎯 Grade" FontWeight="SemiBold" HorizontalAlignment="Center" FontSize="12"/>
                                                        <TextBlock x:Name="DataGradeText" Text="Excellent" FontSize="16" FontWeight="Bold" 
                                                                    HorizontalAlignment="Center" Foreground="#155724"/>
                                                    </StackPanel>
                                                </Grid>
                                            </Border>

                                            <!-- Balance Details -->
                                            <Border Background="#f8f9fa" BorderBrush="#dee2e6" BorderThickness="1" 
                                                    CornerRadius="8" Padding="20" Margin="0,0,0,20">
                                                <Grid>
                                                    <Grid.RowDefinitions>
                                                        <RowDefinition Height="Auto"/>
                                                        <RowDefinition Height="Auto"/>
                                                        <RowDefinition Height="Auto"/>
                                                    </Grid.RowDefinitions>
                                                    <Grid.ColumnDefinitions>
                                                        <ColumnDefinition Width="*"/>
                                                        <ColumnDefinition Width="*"/>
                                                        <ColumnDefinition Width="*"/>
                                                        <ColumnDefinition Width="*"/>
                                                    </Grid.ColumnDefinitions>

                                                    <!-- Headers -->
                                                    <TextBlock Grid.Row="0" Grid.Column="0" Text="Metric" FontWeight="Bold" HorizontalAlignment="Center" Margin="5"/>
                                                    <TextBlock Grid.Row="0" Grid.Column="1" Text="Purchases" FontWeight="Bold" HorizontalAlignment="Center" Margin="5"/>
                                                    <TextBlock Grid.Row="0" Grid.Column="2" Text="Consumption" FontWeight="Bold" HorizontalAlignment="Center" Margin="5"/>
                                                    <TextBlock Grid.Row="0" Grid.Column="3" Text="Variance" FontWeight="Bold" HorizontalAlignment="Center" Margin="5"/>

                                                    <!-- Quantity Row -->
                                                    <TextBlock Grid.Row="1" Grid.Column="0" Text="Quantity (L)" FontWeight="SemiBold" HorizontalAlignment="Center" Margin="5"/>
                                                    <TextBlock Grid.Row="1" Grid.Column="1" x:Name="FIFOTotalPurchaseQuantityText" Text="0.000" HorizontalAlignment="Center" Margin="5"/>
                                                    <TextBlock Grid.Row="1" Grid.Column="2" x:Name="FIFOTotalConsumptionQuantityText" Text="0.000" HorizontalAlignment="Center" Margin="5"/>
                                                    <TextBlock Grid.Row="1" Grid.Column="3" x:Name="QuantityVarianceText" Text="0.000" HorizontalAlignment="Center" Margin="5"/>

                                                    <!-- Value Row -->
                                                    <TextBlock Grid.Row="2" Grid.Column="0" Text="Value (USD)" FontWeight="SemiBold" HorizontalAlignment="Center" Margin="5"/>
                                                    <TextBlock Grid.Row="2" Grid.Column="1" x:Name="FIFOTotalPurchaseValueText" Text="$0.00" HorizontalAlignment="Center" Margin="5"/>
                                                    <TextBlock Grid.Row="2" Grid.Column="2" x:Name="FIFOTotalConsumptionValueText" Text="$0.00" HorizontalAlignment="Center" Margin="5"/>
                                                    <TextBlock Grid.Row="2" Grid.Column="3" x:Name="ValueVarianceText" Text="$0.00" HorizontalAlignment="Center" Margin="5"/>
                                                </Grid>
                                            </Border>

                                            <!-- Balance Issues -->
                                            <TextBlock Text="Balance Issues (if any):" FontWeight="SemiBold" Margin="0,0,0,10"/>
                                            <ListBox x:Name="BalanceIssuesList" Background="White" BorderBrush="#dee2e6" 
                                                        BorderThickness="1" MaxHeight="150" Margin="0,0,0,20"/>
                                        </StackPanel>
                                    </ScrollViewer>
                                </TabItem>

                                <!-- Period Analysis Tab -->
                                <TabItem Header="📅 Period Analysis">
                                    <StackPanel Margin="20">
                                        <TextBlock Text="Period-over-Period Allocation Analysis" FontSize="16" FontWeight="SemiBold" 
                                                    Margin="0,0,0,15" Foreground="#2c3e50"/>

                                        <DataGrid x:Name="PeriodAnalysisGrid" 
                                                  AutoGenerateColumns="False" 
                                                  CanUserAddRows="False"
                                                  CanUserDeleteRows="False"
                                                  GridLinesVisibility="Horizontal"
                                                  HeadersVisibility="Column"
                                                  Background="White"
                                                  BorderThickness="1"
                                                  BorderBrush="#dee2e6"
                                                  MaxHeight="600">

                                            <DataGrid.Columns>
                                                <DataGridTextColumn Header="Period" Binding="{Binding Period}" Width="100"/>
                                                <DataGridTextColumn Header="Purchases (L)" Binding="{Binding PeriodPurchasesL, StringFormat=N3}" Width="120"/>
                                                <DataGridTextColumn Header="Consumption (L)" Binding="{Binding PeriodConsumptionL, StringFormat=N3}" Width="120"/>
                                                <DataGridTextColumn Header="Allocations (L)" Binding="{Binding PeriodAllocationsL, StringFormat=N3}" Width="120"/>
                                                <DataGridTextColumn Header="Allocation Value" Binding="{Binding FormattedPeriodAllocationsValue}" Width="120"/>
                                                <DataGridTextColumn Header="Transactions" Binding="{Binding AllocationTransactions}" Width="100"/>
                                                <DataGridTextColumn Header="Purchase Lots" Binding="{Binding PurchaseLotsInvolved}" Width="100"/>
                                                <DataGridTextColumn Header="FIFO Velocity" Binding="{Binding FIFOVelocity, StringFormat=N2}" Width="100"/>
                                                <DataGridTextColumn Header="Cross Vessel %" Binding="{Binding CrossVesselAllocationsPercent, StringFormat=N1}" Width="120"/>
                                                <DataGridTextColumn Header="Volume Change" Binding="{Binding FormattedVolumeChange}" Width="120"/>
                                                <DataGridTextColumn Header="Value Change" Binding="{Binding FormattedValueChange}" Width="120"/>
                                                <DataGridTextColumn Header="Velocity Change" Binding="{Binding FormattedVelocityChange}" Width="120"/>
                                            </DataGrid.Columns>
                                        </DataGrid>
                                    </StackPanel>
                                </TabItem>

                                <!-- Exception Report Tab -->
                                <TabItem Header="🚨 Exception Report">
                                    <StackPanel Margin="20">
                                        <TextBlock Text="FIFO Allocation Exceptions and Issues" FontSize="16" FontWeight="SemiBold" 
                                                    Margin="0,0,0,15" Foreground="#2c3e50"/>

                                        <DataGrid x:Name="ExceptionReportGrid" 
                                                  AutoGenerateColumns="False" 
                                                  CanUserAddRows="False"
                                                  CanUserDeleteRows="False"
                                                  GridLinesVisibility="Horizontal"
                                                  HeadersVisibility="Column"
                                                  Background="White"
                                                  BorderThickness="1"
                                                  BorderBrush="#dee2e6"
                                                  MaxHeight="600">

                                            <DataGrid.Columns>
                                                <DataGridTextColumn Header="Level" Binding="{Binding ExceptionIcon}" Width="60"/>
                                                <DataGridTextColumn Header="Type" Binding="{Binding ExceptionType}" Width="150"/>
                                                <DataGridTextColumn Header="Description" Binding="{Binding Description}" Width="250"/>
                                                <DataGridTextColumn Header="Invoice Ref" Binding="{Binding InvoiceReference}" Width="100"/>
                                                <DataGridTextColumn Header="Vessel" Binding="{Binding VesselName}" Width="100"/>
                                                <DataGridTextColumn Header="Date" Binding="{Binding FormattedTransactionDate}" Width="100"/>
                                                <DataGridTextColumn Header="Qty Affected" Binding="{Binding FormattedQuantityAffected}" Width="100"/>
                                                <DataGridTextColumn Header="Value Affected" Binding="{Binding FormattedValueAffected}" Width="120"/>
                                                <DataGridTextColumn Header="Recommended Action" Binding="{Binding RecommendedAction}" Width="200"/>
                                                <DataGridTextColumn Header="Status" Binding="{Binding ResolutionStatus}" Width="100"/>
                                            </DataGrid.Columns>
                                        </DataGrid>
                                    </StackPanel>
                                </TabItem>

                            </TabControl>
                        </Grid>
                    </ScrollViewer>
                </TabItem>

                <!-- Cost Analysis Report Tab -->
                <TabItem Header="📊 Cost Analysis">
                    <ScrollViewer VerticalScrollBarVisibility="Auto">
                        <Grid Margin="20">
                            <Grid.RowDefinitions>
                                <RowDefinition Height="Auto"/>
                                <!-- Controls -->
                                <RowDefinition Height="*"/>
                                <!-- Content -->
                            </Grid.RowDefinitions>

                            <!-- Controls -->
                            <Border Grid.Row="0" Background="#f8f9fa" BorderBrush="#dee2e6" BorderThickness="1" 
                                    CornerRadius="8" Padding="20" Margin="0,0,0,20">
                                <Grid>
                                    <Grid.ColumnDefinitions>
                                        <ColumnDefinition Width="Auto"/>
                                        <ColumnDefinition Width="Auto"/>
                                        <ColumnDefinition Width="Auto"/>
                                        <ColumnDefinition Width="Auto"/>
                                        <ColumnDefinition Width="*"/>
                                        <ColumnDefinition Width="Auto"/>
                                        <ColumnDefinition Width="Auto"/>
                                        <ColumnDefinition Width="Auto"/>
                                    </Grid.ColumnDefinitions>

                                    <TextBlock Grid.Column="0" Text="From Date:" VerticalAlignment="Center" Margin="0,0,10,0"/>
                                    <DatePicker Grid.Column="1" x:Name="CostFromDatePicker" Width="120" Margin="0,0,20,0"/>

                                    <TextBlock Grid.Column="2" Text="To Date:" VerticalAlignment="Center" Margin="0,0,10,0"/>
                                    <DatePicker Grid.Column="3" x:Name="CostToDatePicker" Width="120" Margin="0,0,20,0"/>

                                    <Button Grid.Column="5" x:Name="GenerateCostAnalysis" Content="🔄 Generate Analysis" 
                                            Click="GenerateCostAnalysis_Click" 
                                            Background="#3498db" Foreground="White" Padding="15,8" Margin="0,0,10,0"/>

                                    <Button Grid.Column="6" x:Name="ExportCostAnalysis" Content="📤 Export" 
                                            Click="ExportCostAnalysis_Click" 
                                            Background="#27ae60" Foreground="White" Padding="15,8" Margin="0,0,10,0"/>
                                    <Button Grid.Column="7" x:Name="PrintCostAnalysis" Content="🖨️ Print" 
                                            Click="PrintVesselAccount_Click" 
                                            Background="#6c757d" Foreground="White" Padding="15,8"/>
                                </Grid>
                            </Border>

                            <!-- Content -->
                            <TabControl Grid.Row="1" Background="White" BorderBrush="#dee2e6" BorderThickness="1">

                                <!-- Overview Tab -->
                                <TabItem Header="📋 Overview">
                                    <ScrollViewer VerticalScrollBarVisibility="Auto">
                                        <StackPanel Margin="20">
                                            <!-- Summary Cards -->
                                            <Grid Margin="0,0,0,30">
                                                <Grid.ColumnDefinitions>
                                                    <ColumnDefinition Width="*"/>
                                                    <ColumnDefinition Width="*"/>
                                                    <ColumnDefinition Width="*"/>
                                                    <ColumnDefinition Width="*"/>
                                                    <ColumnDefinition Width="*"/>
                                                </Grid.ColumnDefinitions>

                                                <!-- Total Procurement Value -->
                                                <Border Grid.Column="0" Background="#3498db" CornerRadius="8" Padding="20" Margin="0,0,10,0">
                                                    <StackPanel>
                                                        <TextBlock Text="💰" FontSize="24" HorizontalAlignment="Center" Foreground="White"/>
                                                        <TextBlock Text="Total Procurement" FontSize="12" HorizontalAlignment="Center" Foreground="White" Margin="0,5,0,0"/>
                                                        <TextBlock x:Name="CostTotalProcurementText" Text="$0.00" FontSize="16" FontWeight="Bold" 
                                                                 HorizontalAlignment="Center" Foreground="White" Margin="0,5,0,0"/>
                                                    </StackPanel>
                                                </Border>

                                                <!-- Average Cost Per Liter -->
                                                <Border Grid.Column="1" Background="#e74c3c" CornerRadius="8" Padding="20" Margin="0,0,10,0">
                                                    <StackPanel>
                                                        <TextBlock Text="⛽" FontSize="24" HorizontalAlignment="Center" Foreground="White"/>
                                                        <TextBlock Text="Avg Cost/Liter" FontSize="12" HorizontalAlignment="Center" Foreground="White" Margin="0,5,0,0"/>
                                                        <TextBlock x:Name="CostAvgPerLiterText" Text="$0.000000" FontSize="16" FontWeight="Bold" 
                                                                 HorizontalAlignment="Center" Foreground="White" Margin="0,5,0,0"/>
                                                    </StackPanel>
                                                </Border>

                                                <!-- Average Cost Per Ton -->
                                                <Border Grid.Column="2" Background="#9b59b6" CornerRadius="8" Padding="20" Margin="0,0,10,0">
                                                    <StackPanel>
                                                        <TextBlock Text="🏗️" FontSize="24" HorizontalAlignment="Center" Foreground="White"/>
                                                        <TextBlock Text="Avg Cost/Ton" FontSize="12" HorizontalAlignment="Center" Foreground="White" Margin="0,5,0,0"/>
                                                        <TextBlock x:Name="CostAvgPerTonText" Text="$0.00" FontSize="16" FontWeight="Bold" 
                                                                 HorizontalAlignment="Center" Foreground="White" Margin="0,5,0,0"/>
                                                    </StackPanel>
                                                </Border>

                                                <!-- Price Volatility Index -->
                                                <Border Grid.Column="3" Background="#f39c12" CornerRadius="8" Padding="20" Margin="0,0,10,0">
                                                    <StackPanel>
                                                        <TextBlock Text="📈" FontSize="24" HorizontalAlignment="Center" Foreground="White"/>
                                                        <TextBlock Text="Price Volatility" FontSize="12" HorizontalAlignment="Center" Foreground="White" Margin="0,5,0,0"/>
                                                        <TextBlock x:Name="CostVolatilityText" Text="0.0%" FontSize="16" FontWeight="Bold" 
                                                                 HorizontalAlignment="Center" Foreground="White" Margin="0,5,0,0"/>
                                                    </StackPanel>
                                                </Border>

                                                <!-- Procurement Efficiency Score -->
                                                <Border Grid.Column="4" Background="#27ae60" CornerRadius="8" Padding="20">
                                                    <StackPanel>
                                                        <TextBlock Text="🎯" FontSize="24" HorizontalAlignment="Center" Foreground="White"/>
                                                        <TextBlock Text="Efficiency Score" FontSize="12" HorizontalAlignment="Center" Foreground="White" Margin="0,5,0,0"/>
                                                        <TextBlock x:Name="CostEfficiencyScoreText" Text="0%" FontSize="16" FontWeight="Bold" 
                                                                 HorizontalAlignment="Center" Foreground="White" Margin="0,5,0,0"/>
                                                    </StackPanel>
                                                </Border>
                                            </Grid>

                                            <!-- Key Metrics Section -->
                                            <Border Background="White" BorderBrush="#dee2e6" BorderThickness="1" 
                                                  CornerRadius="6" Padding="20" Margin="0,0,0,20">
                                                <StackPanel>
                                                    <TextBlock Text="🔍 Key Performance Indicators" FontSize="16" FontWeight="SemiBold" 
                                                             Margin="0,0,0,15" Foreground="#2c3e50"/>

                                                    <Grid>
                                                        <Grid.ColumnDefinitions>
                                                            <ColumnDefinition Width="*"/>
                                                            <ColumnDefinition Width="*"/>
                                                        </Grid.ColumnDefinitions>

                                                        <StackPanel Grid.Column="0">
                                                            <TextBlock x:Name="CostBestSupplierText" Text="Best Supplier: N/A" FontSize="14" Margin="0,5"/>
                                                            <TextBlock x:Name="CostWorstSupplierText" Text="Worst Supplier: N/A" FontSize="14" Margin="0,5"/>
                                                            <TextBlock x:Name="CostSavingsOpportunityText" Text="Savings Opportunity: $0.00" FontSize="14" Margin="0,5"/>
                                                            <TextBlock x:Name="CostUniqueSuppliersText" Text="Unique Suppliers: 0" FontSize="14" Margin="0,5"/>
                                                        </StackPanel>

                                                        <StackPanel Grid.Column="1">
                                                            <TextBlock x:Name="CostLowestPriceText" Text="Lowest Price: $0.000000" FontSize="14" Margin="0,5"/>
                                                            <TextBlock x:Name="CostHighestPriceText" Text="Highest Price: $0.000000" FontSize="14" Margin="0,5"/>
                                                            <TextBlock x:Name="CostMostEfficientMonthText" Text="Most Efficient Month: N/A" FontSize="14" Margin="0,5"/>
                                                            <TextBlock x:Name="CostTotalTransactionsText" Text="Total Transactions: 0" FontSize="14" Margin="0,5"/>
                                                        </StackPanel>
                                                    </Grid>
                                                </StackPanel>
                                            </Border>
                                        </StackPanel>
                                    </ScrollViewer>
                                </TabItem>

                                <!-- Price Trends Tab -->
                                <TabItem Header="📈 Price Trends">
                                    <StackPanel Margin="20">
                                        <TextBlock Text="Price Trend Analysis Over Time" FontSize="16" FontWeight="SemiBold" 
                                                 Margin="0,0,0,15" Foreground="#2c3e50"/>

                                        <DataGrid x:Name="PriceTrendsGrid" 
                                                AutoGenerateColumns="False" 
                                                CanUserAddRows="False"
                                                CanUserDeleteRows="False"
                                                GridLinesVisibility="Horizontal"
                                                HeadersVisibility="Column"
                                                Background="White"
                                                BorderThickness="1"
                                                BorderBrush="#dee2e6"
                                                MaxHeight="700">

                                            <DataGrid.Columns>
                                                <DataGridTextColumn Header="Month" Binding="{Binding FormattedMonth}" Width="100"/>
                                                <DataGridTextColumn Header="Trend" Binding="{Binding TrendIcon}" Width="60"/>
                                                <DataGridTextColumn Header="Avg Cost/L" Binding="{Binding AvgCostPerLiterUSD, StringFormat=C6}" Width="120"/>
                                                <DataGridTextColumn Header="Avg Cost/T" Binding="{Binding AvgCostPerTonUSD, StringFormat=C2}" Width="120"/>
                                                <DataGridTextColumn Header="Volume (L)" Binding="{Binding TotalVolumeL, StringFormat=N3}" Width="120"/>
                                                <DataGridTextColumn Header="Total Value" Binding="{Binding FormattedTotalValue}" Width="120"/>
                                                <DataGridTextColumn Header="Transactions" Binding="{Binding TransactionCount}" Width="100"/>
                                                <DataGridTextColumn Header="Price Change" Binding="{Binding FormattedPriceVariance}" Width="120"/>
                                                <DataGridTextColumn Header="Volume Change" Binding="{Binding FormattedVolumeVariance}" Width="120"/>
                                                <DataGridTextColumn Header="Volatility" Binding="{Binding MarketVolatility, StringFormat=N2}" Width="100"/>
                                                <DataGridTextColumn Header="Best Supplier" Binding="{Binding BestSupplierThisMonth}" Width="120"/>
                                                <DataGridTextColumn Header="Best Price" Binding="{Binding BestPriceThisMonth, StringFormat=C6}" Width="120"/>
                                            </DataGrid.Columns>
                                        </DataGrid>
                                    </StackPanel>
                                </TabItem>

                                <!-- Supplier Comparison Tab -->
                                <TabItem Header="🏢 Supplier Comparison">
                                    <StackPanel Margin="20">
                                        <TextBlock Text="Supplier Cost Performance Comparison" FontSize="16" FontWeight="SemiBold" 
                                                 Margin="0,0,0,15" Foreground="#2c3e50"/>

                                        <DataGrid x:Name="SupplierComparisonGrid" 
                                                AutoGenerateColumns="False" 
                                                CanUserAddRows="False"
                                                CanUserDeleteRows="False"
                                                GridLinesVisibility="Horizontal"
                                                HeadersVisibility="Column"
                                                Background="White"
                                                BorderThickness="1"
                                                BorderBrush="#dee2e6"
                                                MaxHeight="700">

                                            <DataGrid.Columns>
                                                <DataGridTextColumn Header="Rank" Binding="{Binding CostCompetitivenessRank}" Width="60"/>
                                                <DataGridTextColumn Header="Supplier" Binding="{Binding SupplierName}" Width="120"/>
                                                <DataGridTextColumn Header="Currency" Binding="{Binding Currency}" Width="80"/>
                                                <DataGridTextColumn Header="Avg Cost/L (USD)" Binding="{Binding AvgCostPerLiterUSD, StringFormat=C6}" Width="140"/>
                                                <DataGridTextColumn Header="Avg Cost/T (USD)" Binding="{Binding AvgCostPerTonUSD, StringFormat=C2}" Width="140"/>
                                                <DataGridTextColumn Header="Avg Cost/L (Orig)" Binding="{Binding FormattedAvgCostOriginal}" Width="140"/>
                                                <DataGridTextColumn Header="Total Volume (L)" Binding="{Binding TotalVolumeL, StringFormat=N3}" Width="140"/>
                                                <DataGridTextColumn Header="Total Value" Binding="{Binding FormattedTotalValue}" Width="120"/>
                                                <DataGridTextColumn Header="Market Share" Binding="{Binding FormattedMarketShare}" Width="120"/>
                                                <DataGridTextColumn Header="Transactions" Binding="{Binding TransactionCount}" Width="100"/>
                                                <DataGridTextColumn Header="Price Consistency" Binding="{Binding FormattedPriceConsistency}" Width="140"/>
                                                <DataGridTextColumn Header="vs Market" Binding="{Binding FormattedCostAdvantage}" Width="120"/>
                                                <DataGridTextColumn Header="Performance" Binding="{Binding PerformanceCategory}" Width="140"/>
                                                <DataGridTextColumn Header="Payment Score" Binding="{Binding PaymentReliabilityScore, StringFormat=N1}" Width="120"/>
                                            </DataGrid.Columns>
                                        </DataGrid>
                                    </StackPanel>
                                </TabItem>

                                <!-- Cost Variance Tab -->
                                <TabItem Header="📊 Cost Variance">
                                    <StackPanel Margin="20">
                                        <TextBlock Text="Actual vs Budgeted Cost Analysis" FontSize="16" FontWeight="SemiBold" 
                                                 Margin="0,0,0,15" Foreground="#2c3e50"/>

                                        <DataGrid x:Name="CostVarianceGrid" 
                                                AutoGenerateColumns="False" 
                                                CanUserAddRows="False"
                                                CanUserDeleteRows="False"
                                                GridLinesVisibility="Horizontal"
                                                HeadersVisibility="Column"
                                                Background="White"
                                                BorderThickness="1"
                                                BorderBrush="#dee2e6"
                                                MaxHeight="700">

                                            <DataGrid.Columns>
                                                <DataGridTextColumn Header="Month" Binding="{Binding FormattedMonth}" Width="100"/>
                                                <DataGridTextColumn Header="Status" Binding="{Binding VarianceIcon}" Width="60"/>
                                                <DataGridTextColumn Header="Budgeted Cost/L" Binding="{Binding BudgetedCostPerLiterUSD, StringFormat=C6}" Width="140"/>
                                                <DataGridTextColumn Header="Actual Cost/L" Binding="{Binding ActualCostPerLiterUSD, StringFormat=C6}" Width="140"/>
                                                <DataGridTextColumn Header="Variance Amount" Binding="{Binding FormattedVarianceAmount}" Width="140"/>
                                                <DataGridTextColumn Header="Variance %" Binding="{Binding FormattedVariancePercentage}" Width="120"/>
                                                <DataGridTextColumn Header="Budgeted Volume" Binding="{Binding BudgetedVolumeL, StringFormat=N3}" Width="140"/>
                                                <DataGridTextColumn Header="Actual Volume" Binding="{Binding ActualVolumeL, StringFormat=N3}" Width="140"/>
                                                <DataGridTextColumn Header="Volume Variance" Binding="{Binding FormattedVolumeVariance}" Width="140"/>
                                                <DataGridTextColumn Header="Total Budget" Binding="{Binding TotalBudgetUSD, StringFormat=C2}" Width="120"/>
                                                <DataGridTextColumn Header="Total Actual" Binding="{Binding TotalActualUSD, StringFormat=C2}" Width="120"/>
                                                <DataGridTextColumn Header="Total Variance" Binding="{Binding FormattedTotalVariance}" Width="140"/>
                                                <DataGridTextColumn Header="Category" Binding="{Binding VarianceCategory}" Width="120"/>
                                                <DataGridTextColumn Header="Primary Driver" Binding="{Binding PrimaryVarianceDriver}" Width="140"/>
                                            </DataGrid.Columns>
                                        </DataGrid>
                                    </StackPanel>
                                </TabItem>

                                <!-- Procurement Efficiency Tab -->
                                <TabItem Header="🎯 Procurement Efficiency">
                                    <StackPanel Margin="20">
                                        <TextBlock Text="Supplier Procurement Efficiency Metrics" FontSize="16" FontWeight="SemiBold" 
                                                 Margin="0,0,0,15" Foreground="#2c3e50"/>

                                        <DataGrid x:Name="ProcurementEfficiencyGrid" 
                                                AutoGenerateColumns="False" 
                                                CanUserAddRows="False"
                                                CanUserDeleteRows="False"
                                                GridLinesVisibility="Horizontal"
                                                HeadersVisibility="Column"
                                                Background="White"
                                                BorderThickness="1"
                                                BorderBrush="#dee2e6"
                                                MaxHeight="700">

                                            <DataGrid.Columns>
                                                <DataGridTextColumn Header="Grade" Binding="{Binding EfficiencyIcon}" Width="60"/>
                                                <DataGridTextColumn Header="Supplier" Binding="{Binding SupplierName}" Width="120"/>
                                                <DataGridTextColumn Header="Efficiency Score" Binding="{Binding FormattedEfficiencyScore}" Width="120"/>
                                                <DataGridTextColumn Header="Cost Optimization" Binding="{Binding CostOptimizationRating, StringFormat=N1}" Width="140"/>
                                                <DataGridTextColumn Header="Price Negotiation" Binding="{Binding PriceNegotiationScore, StringFormat=N1}" Width="140"/>
                                                <DataGridTextColumn Header="Volume Efficiency" Binding="{Binding VolumeEfficiencyScore, StringFormat=N1}" Width="140"/>
                                                <DataGridTextColumn Header="Timing Efficiency" Binding="{Binding TimingEfficiencyScore, StringFormat=N1}" Width="140"/>
                                                <DataGridTextColumn Header="Quality Score" Binding="{Binding QualityConsistencyScore, StringFormat=N1}" Width="120"/>
                                                <DataGridTextColumn Header="Payment Terms" Binding="{Binding PaymentTermsScore, StringFormat=N1}" Width="120"/>
                                                <DataGridTextColumn Header="Risk Score" Binding="{Binding RiskAssessmentScore, StringFormat=N1}" Width="120"/>
                                                <DataGridTextColumn Header="Optimal Purchases" Binding="{Binding OptimalPurchaseCount}" Width="140"/>
                                                <DataGridTextColumn Header="Sub-Optimal" Binding="{Binding SubOptimalPurchaseCount}" Width="120"/>
                                                <DataGridTextColumn Header="Potential Savings" Binding="{Binding FormattedPotentialSavings}" Width="140"/>
                                                <DataGridTextColumn Header="Grade" Binding="{Binding EfficiencyGrade}" Width="80"/>
                                                <DataGridTextColumn Header="Recommended Action" Binding="{Binding RecommendedAction}" Width="200"/>
                                            </DataGrid.Columns>
                                        </DataGrid>
                                    </StackPanel>
                                </TabItem>

                                <!-- Market Benchmarking Tab -->
                                <TabItem Header="📊 Market Benchmarking">
                                    <StackPanel Margin="20">
                                        <TextBlock Text="Market Position and Competitive Analysis" FontSize="16" FontWeight="SemiBold" 
                                                 Margin="0,0,0,15" Foreground="#2c3e50"/>

                                        <DataGrid x:Name="MarketBenchmarkingGrid" 
                                                AutoGenerateColumns="False" 
                                                CanUserAddRows="False"
                                                CanUserDeleteRows="False"
                                                GridLinesVisibility="Horizontal"
                                                HeadersVisibility="Column"
                                                Background="White"
                                                BorderThickness="1"
                                                BorderBrush="#dee2e6"
                                                MaxHeight="700">

                                            <DataGrid.Columns>
                                                <DataGridTextColumn Header="Period" Binding="{Binding FormattedPeriod}" Width="100"/>
                                                <DataGridTextColumn Header="Status" Binding="{Binding BenchmarkIcon}" Width="60"/>
                                                <DataGridTextColumn Header="Market Avg Cost" Binding="{Binding MarketAverageCostUSD, StringFormat=C6}" Width="140"/>
                                                <DataGridTextColumn Header="Company Avg Cost" Binding="{Binding CompanyAverageCostUSD, StringFormat=C6}" Width="140"/>
                                                <DataGridTextColumn Header="Market Position" Binding="{Binding FormattedMarketPosition}" Width="120"/>
                                                <DataGridTextColumn Header="Cost Advantage" Binding="{Binding FormattedCostAdvantage}" Width="140"/>
                                                <DataGridTextColumn Header="Competitive Index" Binding="{Binding CompetitiveIndexScore, StringFormat=N1}" Width="140"/>
                                                <DataGridTextColumn Header="Performance Category" Binding="{Binding MarketPerformanceCategory}" Width="160"/>
                                                <DataGridTextColumn Header="Benchmark Status" Binding="{Binding BenchmarkStatus}" Width="140"/>
                                                <DataGridTextColumn Header="Optimization Opportunity" Binding="{Binding FormattedOptimizationOpportunity}" Width="180"/>
                                                <DataGridTextColumn Header="Risk Level" Binding="{Binding RiskLevel}" Width="100"/>
                                                <DataGridTextColumn Header="Strategic Recommendation" Binding="{Binding StrategicRecommendation}" Width="300"/>
                                            </DataGrid.Columns>
                                        </DataGrid>
                                    </StackPanel>
                                </TabItem>

                                <!-- Help Tab -->
                                <TabItem Header="❓ Help">
                                    <ScrollViewer VerticalScrollBarVisibility="Auto">
                                        <StackPanel Margin="20">
                                            <TextBlock Text="Cost Analysis Calculations and Definitions" FontSize="18" FontWeight="Bold" 
                                                     Margin="0,0,0,20" Foreground="#2c3e50"/>

                                            <!-- Overview Calculations -->
                                            <Border Background="#f8f9fa" BorderBrush="#dee2e6" BorderThickness="1" 
                                                  CornerRadius="6" Padding="15" Margin="0,0,0,20">
                                                <StackPanel>
                                                    <TextBlock Text="📋 Overview" FontSize="16" FontWeight="SemiBold" 
                                                             Margin="0,0,0,10" Foreground="#2c3e50"/>
                                                    <TextBlock Text="• Total Procurement: Sum of all purchase values in USD within date range" FontSize="12" Margin="5,2"/>
                                                    <TextBlock Text="• Avg Cost/Liter: Total procurement value ÷ Total volume in liters" FontSize="12" Margin="5,2"/>
                                                    <TextBlock Text="• Avg Cost/Ton: Total procurement value ÷ Total volume in tons" FontSize="12" Margin="5,2"/>
                                                    <TextBlock Text="• Price Volatility: Coefficient of variation (Standard Deviation ÷ Mean × 100) of monthly average costs" FontSize="12" Margin="5,2"/>
                                                    <TextBlock Text="• Efficiency Score: Weighted average of consistency (100-volatility) and volume efficiency scores" FontSize="12" Margin="5,2"/>
                                                    <TextBlock Text="• Best/Worst Supplier: Suppliers with lowest/highest average cost per liter" FontSize="12" Margin="5,2"/>
                                                    <TextBlock Text="• Savings Opportunity: (Worst supplier avg cost - Best supplier avg cost) × Total volume" FontSize="12" Margin="5,2"/>
                                                </StackPanel>
                                            </Border>

                                            <!-- Price Trends Calculations -->
                                            <Border Background="#f8f9fa" BorderBrush="#dee2e6" BorderThickness="1" 
                                                  CornerRadius="6" Padding="15" Margin="0,0,0,20">
                                                <StackPanel>
                                                    <TextBlock Text="📈 Price Trends" FontSize="16" FontWeight="SemiBold" 
                                                             Margin="0,0,0,10" Foreground="#2c3e50"/>
                                                    <TextBlock Text="• Avg Cost/L: Monthly total value ÷ Monthly total volume in liters" FontSize="12" Margin="5,2"/>
                                                    <TextBlock Text="• Avg Cost/T: Monthly total value ÷ Monthly total volume in tons" FontSize="12" Margin="5,2"/>
                                                    <TextBlock Text="• Price Change: ((Current month cost - Previous month cost) ÷ Previous month cost) × 100" FontSize="12" Margin="5,2"/>
                                                    <TextBlock Text="• Volume Change: ((Current month volume - Previous month volume) ÷ Previous month volume) × 100" FontSize="12" Margin="5,2"/>
                                                    <TextBlock Text="• Trend Direction: Increasing (above +2%), Decreasing (below -2%), or Stable (within ±2%)" FontSize="12" Margin="5,2"/>
                                                    <TextBlock Text="• Volatility: Coefficient of variation of all supplier prices within the month" FontSize="12" Margin="5,2"/>
                                                    <TextBlock Text="• Best/Worst Price: Lowest/highest average cost per liter among suppliers in that month" FontSize="12" Margin="5,2"/>
                                                </StackPanel>
                                            </Border>

                                            <!-- Supplier Comparison Calculations -->
                                            <Border Background="#f8f9fa" BorderBrush="#dee2e6" BorderThickness="1" 
                                                  CornerRadius="6" Padding="15" Margin="0,0,0,20">
                                                <StackPanel>
                                                    <TextBlock Text="🏢 Supplier Comparison" FontSize="16" FontWeight="SemiBold" 
                                                             Margin="0,0,0,10" Foreground="#2c3e50"/>
                                                    <TextBlock Text="• Rank: Suppliers ordered by average cost per liter (lowest = rank 1)" FontSize="12" Margin="5,2"/>
                                                    <TextBlock Text="• Avg Cost/L (USD): Total value in USD ÷ Total volume in liters for this supplier" FontSize="12" Margin="5,2"/>
                                                    <TextBlock Text="• Avg Cost/T (USD): Total value in USD ÷ Total volume in tons for this supplier" FontSize="12" Margin="5,2"/>
                                                    <TextBlock Text="• Avg Cost/L (Orig): Total value in original currency ÷ Total volume in liters" FontSize="12" Margin="5,2"/>
                                                    <TextBlock Text="• Market Share: (Supplier's total value ÷ Total market value) × 100" FontSize="12" Margin="5,2"/>
                                                    <TextBlock Text="• Price Consistency: 100 - Coefficient of variation of this supplier's transaction prices" FontSize="12" Margin="5,2"/>
                                                    <TextBlock Text="• vs Market: ((Market average cost - Supplier cost) ÷ Market average cost) × 100" FontSize="12" Margin="5,2"/>
                                                    <TextBlock Text="• Performance: Best in Class (rank 1), Highly Competitive (2-3), Competitive (4-5), Average (6-8), Below Average (9+)" FontSize="12" Margin="5,2"/>
                                                    <TextBlock Text="• Payment Score: Percentage of invoices paid on or before due date" FontSize="12" Margin="5,2"/>
                                                </StackPanel>
                                            </Border>

                                            <!-- Cost Variance Calculations -->
                                            <Border Background="#f8f9fa" BorderBrush="#dee2e6" BorderThickness="1" 
                                                  CornerRadius="6" Padding="15" Margin="0,0,0,20">
                                                <StackPanel>
                                                    <TextBlock Text="📊 Cost Variance" FontSize="16" FontWeight="SemiBold" 
                                                             Margin="0,0,0,10" Foreground="#2c3e50"/>
                                                    <TextBlock Text="• Budgeted Cost/L: Overall average cost per liter (rolling baseline)" FontSize="12" Margin="5,2"/>
                                                    <TextBlock Text="• Variance Amount: Actual cost per liter - Budgeted cost per liter" FontSize="12" Margin="5,2"/>
                                                    <TextBlock Text="• Variance %: (Variance amount ÷ Budgeted cost) × 100" FontSize="12" Margin="5,2"/>
                                                    <TextBlock Text="• Volume Variance: Actual volume - Budgeted volume (average volume)" FontSize="12" Margin="5,2"/>
                                                    <TextBlock Text="• Total Variance: Actual total value - Budgeted total value" FontSize="12" Margin="5,2"/>
                                                    <TextBlock Text="• Category: Favorable (below 0%), Within Range (±5%), Unfavorable (above 0%)" FontSize="12" Margin="5,2"/>
                                                    <TextBlock Text="• Primary Driver: Price Variance if |price variance| > |volume variance|, otherwise Volume Variance" FontSize="12" Margin="5,2"/>
                                                </StackPanel>
                                            </Border>

                                            <!-- Procurement Efficiency Calculations -->
                                            <Border Background="#f8f9fa" BorderBrush="#dee2e6" BorderThickness="1" 
                                                  CornerRadius="6" Padding="15" Margin="0,0,0,20">
                                                <StackPanel>
                                                    <TextBlock Text="🎯 Procurement Efficiency" FontSize="16" FontWeight="SemiBold" 
                                                             Margin="0,0,0,10" Foreground="#2c3e50"/>
                                                    <TextBlock Text="• Efficiency Score: Weighted average (30% cost + 20% negotiation + 15% volume + 15% timing + 10% quality + 5% payment + 5% risk)" FontSize="12" Margin="5,2"/>
                                                    <TextBlock Text="• Cost Optimization: Based on cost trend improvement over time (base 75 + improvement %)" FontSize="12" Margin="5,2"/>
                                                    <TextBlock Text="• Price Negotiation: 100 - Price volatility (lower volatility = better negotiation)" FontSize="12" Margin="5,2"/>
                                                    <TextBlock Text="• Volume Efficiency: (Average volume per transaction ÷ 5000) × 100, capped at 100" FontSize="12" Margin="5,2"/>
                                                    <TextBlock Text="• Timing Efficiency: 85 if average days between purchases is 15-60, otherwise 60" FontSize="12" Margin="5,2"/>
                                                    <TextBlock Text="• Quality Score: 100 - (Density volatility × 10), minimum 60" FontSize="12" Margin="5,2"/>
                                                    <TextBlock Text="• Payment Terms: Score based on average payment terms (30+ days = 95, 15-30 = 85, 7-15 = 70, below 7 = 50)" FontSize="12" Margin="5,2"/>
                                                    <TextBlock Text="• Risk Score: Supplier diversification score (supplier count × 20), minimum 40" FontSize="12" Margin="5,2"/>
                                                    <TextBlock Text="• Optimal Purchases: Count of purchases at or below market average cost" FontSize="12" Margin="5,2"/>
                                                    <TextBlock Text="• Potential Savings: Sum of excess costs above market average for sub-optimal purchases" FontSize="12" Margin="5,2"/>
                                                    <TextBlock Text="• Grade: A (90 or above), B (80-89), C (70-79), D (60-69), F (below 60)" FontSize="12" Margin="5,2"/>
                                                </StackPanel>
                                            </Border>

                                            <!-- Market Benchmarking Calculations -->
                                            <Border Background="#f8f9fa" BorderBrush="#dee2e6" BorderThickness="1" 
                                                  CornerRadius="6" Padding="15" Margin="0,0,0,20">
                                                <StackPanel>
                                                    <TextBlock Text="📊 Market Benchmarking" FontSize="16" FontWeight="SemiBold" 
                                                             Margin="0,0,0,10" Foreground="#2c3e50"/>
                                                    <TextBlock Text="• Market Avg Cost: Simulated market average (company cost ± 5% random variation)" FontSize="12" Margin="5,2"/>
                                                    <TextBlock Text="• Market Position: ((Market avg - Company avg) ÷ Market avg) × 100 + 50, constrained to 5-95%" FontSize="12" Margin="5,2"/>
                                                    <TextBlock Text="• Cost Advantage: Company average cost - Market average cost" FontSize="12" Margin="5,2"/>
                                                    <TextBlock Text="• Competitive Index: (Market position - 50) × 2, scale -100 to +100" FontSize="12" Margin="5,2"/>
                                                    <TextBlock Text="• Performance Category: Leading (80% or above), Competitive (60-79%), Below Average (40-59%), Underperforming (below 40%)" FontSize="12" Margin="5,2"/>
                                                    <TextBlock Text="• Optimization Opportunity: Cost advantage × Total volume (if positive advantage)" FontSize="12" Margin="5,2"/>
                                                    <TextBlock Text="• Risk Level: Low (Leading), Medium (Competitive), High (Below Average), Critical (Underperforming)" FontSize="12" Margin="5,2"/>
                                                    <TextBlock Text="• Strategic Recommendation: Action plan based on performance category and market position" FontSize="12" Margin="5,2"/>
                                                </StackPanel>
                                            </Border>

                                            <!-- General Notes -->
                                            <Border Background="#e8f4fd" BorderBrush="#3498db" BorderThickness="1" 
                                                  CornerRadius="6" Padding="15">
                                                <StackPanel>
                                                    <TextBlock Text="📝 General Notes" FontSize="16" FontWeight="SemiBold" 
                                                             Margin="0,0,0,10" Foreground="#2c3e50"/>
                                                    <TextBlock Text="• All calculations use FIFO (First-In, First-Out) allocation principles" FontSize="12" Margin="5,2"/>
                                                    <TextBlock Text="• Currency conversions are applied using supplier-specific exchange rates" FontSize="12" Margin="5,2"/>
                                                    <TextBlock Text="• Negative values are displayed in brackets () following accounting standards" FontSize="12" Margin="5,2"/>
                                                    <TextBlock Text="• Quantities are shown with 3 decimal places (N3 format)" FontSize="12" Margin="5,2"/>
                                                    <TextBlock Text="• Prices per liter use 6 decimal places (C6 format) for precision" FontSize="12" Margin="5,2"/>
                                                    <TextBlock Text="• USD amounts use 2 decimal places (C2 format)" FontSize="12" Margin="5,2"/>
                                                    <TextBlock Text="• Percentages are calculated to 1-2 decimal places based on context" FontSize="12" Margin="5,2"/>
                                                    <TextBlock Text="• Market benchmarking uses simulated data in absence of external market data" FontSize="12" Margin="5,2"/>
                                                </StackPanel>
                                            </Border>
                                        </StackPanel>
                                    </ScrollViewer>
                                </TabItem>

                            </TabControl>
                        </Grid>
                    </ScrollViewer>
                </TabItem>

                <!-- Route Performance Report Tab -->
                <TabItem Header="🛣️ Route Performance">
                    <ScrollViewer VerticalScrollBarVisibility="Auto">
                        <Grid Margin="20">
                            <Grid.RowDefinitions>
                                <RowDefinition Height="Auto"/>
                                <!-- Controls -->
                                <RowDefinition Height="*"/>
                                <!-- Content -->
                            </Grid.RowDefinitions>

                            <!-- Controls -->
                            <Border Grid.Row="0" Background="#f8f9fa" BorderBrush="#dee2e6" BorderThickness="1" 
                                    CornerRadius="8" Padding="20" Margin="0,0,0,20">
                                <Grid>
                                    <Grid.ColumnDefinitions>
                                        <ColumnDefinition Width="Auto"/>
                                        <ColumnDefinition Width="Auto"/>
                                        <ColumnDefinition Width="Auto"/>
                                        <ColumnDefinition Width="Auto"/>
                                        <ColumnDefinition Width="*"/>
                                        <ColumnDefinition Width="Auto"/>
                                        <ColumnDefinition Width="Auto"/>
                                        <ColumnDefinition Width="Auto"/>
                                    </Grid.ColumnDefinitions>

                                    <TextBlock Grid.Column="0" Text="From Date:" VerticalAlignment="Center" Margin="0,0,10,0"/>
                                    <DatePicker Grid.Column="1" x:Name="RouteFromDatePicker" Width="120" Margin="0,0,20,0"/>

                                    <TextBlock Grid.Column="2" Text="To Date:" VerticalAlignment="Center" Margin="0,0,10,0"/>
                                    <DatePicker Grid.Column="3" x:Name="RouteToDatePicker" Width="120" Margin="0,0,20,0"/>

                                    <Button Grid.Column="5" x:Name="GenerateRoutePerformance" Content="🔄 Generate Analysis" 
                                            Click="GenerateRoutePerformance_Click" 
                                            Background="#3498db" Foreground="White" Padding="15,8" Margin="0,0,10,0"/>

                                    <Button Grid.Column="6" x:Name="ExportRoutePerformance" Content="📤 Export" 
                                            Click="ExportRoutePerformance_Click" 
                                            Background="#27ae60" Foreground="White" Padding="15,8" Margin="0,0,10,0"/>
                                    <Button Grid.Column="7" x:Name="PrintRoutePerformance" Content="🖨️ Print" 
                                            Click="PrintVesselAccount_Click" 
                                            Background="#6c757d" Foreground="White" Padding="15,8"/>
                                </Grid>
                            </Border>

                            <!-- Content -->
                            <TabControl Grid.Row="1" Background="White" BorderBrush="#dee2e6" BorderThickness="1">

                                <!-- Overview Tab -->
                                <TabItem Header="📋 Overview">
                                    <ScrollViewer VerticalScrollBarVisibility="Auto">
                                        <StackPanel Margin="20">
                                            <!-- Summary Cards -->
                                            <Grid Margin="0,0,0,30">
                                                <Grid.ColumnDefinitions>
                                                    <ColumnDefinition Width="*"/>
                                                    <ColumnDefinition Width="*"/>
                                                    <ColumnDefinition Width="*"/>
                                                    <ColumnDefinition Width="*"/>
                                                </Grid.ColumnDefinitions>

                                                <!-- Total Active Routes -->
                                                <Border Grid.Column="0" Background="#3498db" CornerRadius="8" Padding="20" Margin="0,0,10,0">
                                                    <StackPanel>
                                                        <TextBlock Text="🛣️" FontSize="24" HorizontalAlignment="Center" Foreground="White"/>
                                                        <TextBlock Text="Active Routes" FontSize="12" HorizontalAlignment="Center" Foreground="White" Margin="0,5,0,0"/>
                                                        <TextBlock x:Name="RouteTotalActiveRoutesText" Text="0" FontSize="16" FontWeight="Bold" 
                                                                 HorizontalAlignment="Center" Foreground="White" Margin="0,5,0,0"/>
                                                    </StackPanel>
                                                </Border>

                                                <!-- Total Legs Completed -->
                                                <Border Grid.Column="1" Background="#e74c3c" CornerRadius="8" Padding="20" Margin="0,0,10,0">
                                                    <StackPanel>
                                                        <TextBlock Text="🚢" FontSize="24" HorizontalAlignment="Center" Foreground="White"/>
                                                        <TextBlock Text="Total Legs" FontSize="12" HorizontalAlignment="Center" Foreground="White" Margin="0,5,0,0"/>
                                                        <TextBlock x:Name="RouteTotalLegsText" Text="0" FontSize="16" FontWeight="Bold" 
                                                                 HorizontalAlignment="Center" Foreground="White" Margin="0,5,0,0"/>
                                                    </StackPanel>
                                                </Border>

                                                <!-- Total Distance -->
                                                <Border Grid.Column="2" Background="#f39c12" CornerRadius="8" Padding="20" Margin="0,0,10,0">
                                                    <StackPanel>
                                                        <TextBlock Text="📏" FontSize="24" HorizontalAlignment="Center" Foreground="White"/>
                                                        <TextBlock Text="Total Distance" FontSize="12" HorizontalAlignment="Center" Foreground="White" Margin="0,5,0,0"/>
                                                        <TextBlock x:Name="RouteTotalDistanceText" Text="0 km" FontSize="16" FontWeight="Bold" 
                                                                 HorizontalAlignment="Center" Foreground="White" Margin="0,5,0,0"/>
                                                    </StackPanel>
                                                </Border>

                                                <!-- Total Route Cost -->
                                                <Border Grid.Column="3" Background="#27ae60" CornerRadius="8" Padding="20">
                                                    <StackPanel>
                                                        <TextBlock Text="💰" FontSize="24" HorizontalAlignment="Center" Foreground="White"/>
                                                        <TextBlock Text="Total Cost" FontSize="12" HorizontalAlignment="Center" Foreground="White" Margin="0,5,0,0"/>
                                                        <TextBlock x:Name="RouteTotalCostText" Text="$0.00" FontSize="16" FontWeight="Bold" 
                                                                 HorizontalAlignment="Center" Foreground="White" Margin="0,5,0,0"/>
                                                    </StackPanel>
                                                </Border>
                                            </Grid>

                                            <!-- Route Performance Metrics -->
                                            <Border Background="White" BorderBrush="#dee2e6" BorderThickness="1" 
                                                  CornerRadius="6" Padding="20" Margin="0,0,0,20">
                                                <StackPanel>
                                                    <TextBlock Text="🏆 Route Performance Leaders" FontSize="16" FontWeight="SemiBold" 
                                                             Margin="0,0,0,15" Foreground="#2c3e50"/>

                                                    <Grid>
                                                        <Grid.ColumnDefinitions>
                                                            <ColumnDefinition Width="*"/>
                                                            <ColumnDefinition Width="*"/>
                                                        </Grid.ColumnDefinitions>

                                                        <StackPanel Grid.Column="0">
                                                            <TextBlock x:Name="RouteMostEfficientText" Text="Most Efficient: N/A" FontSize="14" Margin="0,5"/>
                                                            <TextBlock x:Name="RouteLeastEfficientText" Text="Least Efficient: N/A" FontSize="14" Margin="0,5"/>
                                                            <TextBlock x:Name="RouteEfficiencyGapText" Text="Efficiency Gap: 0%" FontSize="14" Margin="0,5"/>
                                                            <TextBlock x:Name="RouteAvgCostPerKmText" Text="Avg Cost/km: $0.000000" FontSize="14" Margin="0,5"/>
                                                        </StackPanel>

                                                        <StackPanel Grid.Column="1">
                                                            <TextBlock x:Name="RouteMostProfitableText" Text="Most Profitable: N/A" FontSize="14" Margin="0,5"/>
                                                            <TextBlock x:Name="RouteLeastProfitableText" Text="Least Profitable: N/A" FontSize="14" Margin="0,5"/>
                                                            <TextBlock x:Name="RouteAvgFuelPerKmText" Text="Avg Fuel/km: 0.000 L" FontSize="14" Margin="0,5"/>
                                                            <TextBlock x:Name="RouteBestEfficiencyText" Text="Best Efficiency: 0.000 L/leg" FontSize="14" Margin="0,5"/>
                                                        </StackPanel>
                                                    </Grid>
                                                </StackPanel>
                                            </Border>
                                        </StackPanel>
                                    </ScrollViewer>
                                </TabItem>

                                <!-- Route Comparison Tab -->
                                <TabItem Header="⚖️ Route Comparison">
                                    <StackPanel Margin="20">
                                        <TextBlock Text="Route Type Performance Comparison" FontSize="16" FontWeight="SemiBold" 
                                                 Margin="0,0,0,15" Foreground="#2c3e50"/>

                                        <DataGrid x:Name="RoutePerformanceComparisonGrid" 
                                                AutoGenerateColumns="False" 
                                                CanUserAddRows="False"
                                                CanUserDeleteRows="False"
                                                GridLinesVisibility="Horizontal"
                                                HeadersVisibility="Column"
                                                Background="White"
                                                BorderThickness="1"
                                                BorderBrush="#dee2e6"
                                                MaxHeight="700">

                                            <DataGrid.Columns>
                                                <DataGridTextColumn Header="Route Type" Binding="{Binding RouteType}" Width="120"/>
                                                <DataGridTextColumn Header="Route Description" Binding="{Binding RouteDescription}" Width="180"/>
                                                <DataGridTextColumn Header="Distance (km)" Binding="{Binding EstimatedDistanceKm, StringFormat=N1}" Width="120"/>
                                                <DataGridTextColumn Header="Active Vessels" Binding="{Binding ActiveVessels}" Width="120"/>
                                                <DataGridTextColumn Header="Total Legs" Binding="{Binding TotalLegsCompleted}" Width="100"/>
                                                <DataGridTextColumn Header="Fuel (L)" Binding="{Binding TotalFuelConsumedL, StringFormat=N3}" Width="120"/>
                                                <DataGridTextColumn Header="Fuel (T)" Binding="{Binding TotalFuelConsumedT, StringFormat=N3}" Width="120"/>
                                                <DataGridTextColumn Header="L/Leg" Binding="{Binding AvgEfficiencyLPerLeg, StringFormat=N3}" Width="100"/>
                                                <DataGridTextColumn Header="T/Leg" Binding="{Binding AvgEfficiencyTPerLeg, StringFormat=N3}" Width="100"/>
                                                <DataGridTextColumn Header="L/km" Binding="{Binding AvgEfficiencyLPerKm, StringFormat=N3}" Width="100"/>
                                                <DataGridTextColumn Header="Total Cost" Binding="{Binding FormattedTotalCost}" Width="120"/>
                                                <DataGridTextColumn Header="Cost/Leg" Binding="{Binding FormattedCostPerLeg}" Width="120"/>
                                                <DataGridTextColumn Header="Cost/km" Binding="{Binding FormattedCostPerKm}" Width="120"/>
                                                <DataGridTextColumn Header="Utilization" Binding="{Binding FormattedUtilization}" Width="120"/>
                                                <DataGridTextColumn Header="Performance" Binding="{Binding PerformanceCategory}" Width="140"/>
                                                <DataGridTextColumn Header="Advantage" Binding="{Binding FormattedAdvantage}" Width="120"/>
                                            </DataGrid.Columns>
                                        </DataGrid>
                                    </StackPanel>
                                </TabItem>

                                <!-- Vessel Performance Tab -->
                                <TabItem Header="🚢 Vessel Performance">
                                    <StackPanel Margin="20">
                                        <TextBlock Text="Individual Vessel Route Performance" FontSize="16" FontWeight="SemiBold" 
                                                 Margin="0,0,0,15" Foreground="#2c3e50"/>

                                        <DataGrid x:Name="RoutePerformanceVesselGrid" 
                                                AutoGenerateColumns="False" 
                                                CanUserAddRows="False"
                                                CanUserDeleteRows="False"
                                                GridLinesVisibility="Horizontal"
                                                HeadersVisibility="Column"
                                                Background="White"
                                                BorderThickness="1"
                                                BorderBrush="#dee2e6"
                                                MaxHeight="700">

                                            <DataGrid.Columns>
                                                <DataGridTextColumn Header="Rank" Binding="{Binding RouteRank}" Width="60"/>
                                                <DataGridTextColumn Header="Grade" Binding="{Binding GradeIcon}" Width="60"/>
                                                <DataGridTextColumn Header="Vessel" Binding="{Binding VesselName}" Width="120"/>
                                                <DataGridTextColumn Header="Type" Binding="{Binding VesselType}" Width="80"/>
                                                <DataGridTextColumn Header="Route" Binding="{Binding Route}" Width="180"/>
                                                <DataGridTextColumn Header="Distance (km)" Binding="{Binding EstimatedDistanceKm, StringFormat=N1}" Width="120"/>
                                                <DataGridTextColumn Header="Legs" Binding="{Binding LegsCompleted}" Width="80"/>
                                                <DataGridTextColumn Header="Fuel (L)" Binding="{Binding TotalFuelL, StringFormat=N3}" Width="120"/>
                                                <DataGridTextColumn Header="L/Leg" Binding="{Binding EfficiencyLPerLeg, StringFormat=N3}" Width="100"/>
                                                <DataGridTextColumn Header="T/Leg" Binding="{Binding EfficiencyTPerLeg, StringFormat=N3}" Width="100"/>
                                                <DataGridTextColumn Header="L/km" Binding="{Binding EfficiencyLPerKm, StringFormat=N3}" Width="100"/>
                                                <DataGridTextColumn Header="Total Cost" Binding="{Binding FormattedTotalCost}" Width="120"/>
                                                <DataGridTextColumn Header="Cost/Leg" Binding="{Binding FormattedCostPerLeg}" Width="120"/>
                                                <DataGridTextColumn Header="Cost/km" Binding="{Binding FormattedCostPerKm}" Width="120"/>
                                                <DataGridTextColumn Header="Optimization Score" Binding="{Binding FormattedOptimizationScore}" Width="140"/>
                                                <DataGridTextColumn Header="vs Benchmark" Binding="{Binding FormattedBenchmarkDeviation}" Width="120"/>
                                                <DataGridTextColumn Header="Grade" Binding="{Binding PerformanceGrade}" Width="80"/>
                                                <DataGridTextColumn Header="Recommended Action" Binding="{Binding RecommendedAction}" Width="200"/>
                                            </DataGrid.Columns>
                                        </DataGrid>
                                    </StackPanel>
                                </TabItem>

                                <!-- Efficiency Trends Tab -->
                                <TabItem Header="📈 Efficiency Trends">
                                    <StackPanel Margin="20">
                                        <TextBlock Text="Route Efficiency Trends Over Time" FontSize="16" FontWeight="SemiBold" 
                                                 Margin="0,0,0,15" Foreground="#2c3e50"/>

                                        <DataGrid x:Name="RoutePerformanceTrendsGrid" 
                                                AutoGenerateColumns="False" 
                                                CanUserAddRows="False"
                                                CanUserDeleteRows="False"
                                                GridLinesVisibility="Horizontal"
                                                HeadersVisibility="Column"
                                                Background="White"
                                                BorderThickness="1"
                                                BorderBrush="#dee2e6"
                                                MaxHeight="700">

                                            <DataGrid.Columns>
                                                <DataGridTextColumn Header="Month" Binding="{Binding FormattedMonth}" Width="100"/>
                                                <DataGridTextColumn Header="Trend" Binding="{Binding TrendIcon}" Width="60"/>
                                                <DataGridTextColumn Header="Route" Binding="{Binding RouteType}" Width="180"/>
                                                <DataGridTextColumn Header="L/Leg" Binding="{Binding AvgEfficiencyLPerLeg, StringFormat=N3}" Width="100"/>
                                                <DataGridTextColumn Header="T/Leg" Binding="{Binding AvgEfficiencyTPerLeg, StringFormat=N3}" Width="100"/>
                                                <DataGridTextColumn Header="L/km" Binding="{Binding AvgEfficiencyLPerKm, StringFormat=N3}" Width="100"/>
                                                <DataGridTextColumn Header="Total Legs" Binding="{Binding TotalLegs}" Width="100"/>
                                                <DataGridTextColumn Header="Total Fuel (L)" Binding="{Binding TotalFuelL, StringFormat=N3}" Width="140"/>
                                                <DataGridTextColumn Header="MoM Change (L)" Binding="{Binding FormattedMoMChangeL}" Width="140"/>
                                                <DataGridTextColumn Header="MoM Change (T)" Binding="{Binding FormattedMoMChangeT}" Width="140"/>
                                                <DataGridTextColumn Header="Seasonal Adj" Binding="{Binding SeasonalAdjustment, StringFormat=N3}" Width="120"/>
                                                <DataGridTextColumn Header="Direction" Binding="{Binding TrendDirection}" Width="100"/>
                                                <DataGridTextColumn Header="Volatility" Binding="{Binding EfficiencyVolatility, StringFormat=N2}" Width="100"/>
                                                <DataGridTextColumn Header="Optimality" Binding="{Binding OptimalityIndicator}" Width="120"/>
                                            </DataGrid.Columns>
                                        </DataGrid>
                                    </StackPanel>
                                </TabItem>

                                <!-- Cost Analysis Tab -->
                                <TabItem Header="💰 Cost Analysis">
                                    <StackPanel Margin="20">
                                        <TextBlock Text="Route Cost Analysis and Benchmarking" FontSize="16" FontWeight="SemiBold" 
                                                 Margin="0,0,0,15" Foreground="#2c3e50"/>

                                        <DataGrid x:Name="RoutePerformanceCostGrid" 
                                                AutoGenerateColumns="False" 
                                                CanUserAddRows="False"
                                                CanUserDeleteRows="False"
                                                GridLinesVisibility="Horizontal"
                                                HeadersVisibility="Column"
                                                Background="White"
                                                BorderThickness="1"
                                                BorderBrush="#dee2e6"
                                                MaxHeight="700">

                                            <DataGrid.Columns>
                                                <DataGridTextColumn Header="Rank" Binding="{Binding CostEfficiencyRank}" Width="60"/>
                                                <DataGridTextColumn Header="Route" Binding="{Binding RouteType}" Width="180"/>
                                                <DataGridTextColumn Header="Total Cost" Binding="{Binding FormattedTotalCost}" Width="120"/>
                                                <DataGridTextColumn Header="Cost/Leg" Binding="{Binding FormattedCostPerLeg}" Width="120"/>
                                                <DataGridTextColumn Header="Cost/km" Binding="{Binding FormattedCostPerKm}" Width="120"/>
                                                <DataGridTextColumn Header="Cost/Liter" Binding="{Binding AvgCostPerLiter, StringFormat=C6}" Width="120"/>
                                                <DataGridTextColumn Header="Cost/Ton" Binding="{Binding AvgCostPerTon, StringFormat=C2}" Width="120"/>
                                                <DataGridTextColumn Header="Fuel %" Binding="{Binding FormattedFuelPercentage}" Width="100"/>
                                                <DataGridTextColumn Header="Operational %" Binding="{Binding OperationalCostPercentage, StringFormat=N1}" Width="120"/>
                                                <DataGridTextColumn Header="Variability" Binding="{Binding CostVariabilityIndex, StringFormat=N2}" Width="120"/>
                                                <DataGridTextColumn Header="vs Benchmark" Binding="{Binding FormattedCostAdvantage}" Width="120"/>
                                                <DataGridTextColumn Header="Optimization Potential" Binding="{Binding FormattedOptimizationPotential}" Width="180"/>
                                                <DataGridTextColumn Header="Category" Binding="{Binding CostCategory}" Width="120"/>
                                                <DataGridTextColumn Header="Cost Drivers" Binding="{Binding CostDrivers}" Width="140"/>
                                            </DataGrid.Columns>
                                        </DataGrid>
                                    </StackPanel>
                                </TabItem>

                                <!-- Optimization Recommendations Tab -->
                                <TabItem Header="🎯 Optimization">
                                    <StackPanel Margin="20">
                                        <TextBlock Text="Route Optimization Recommendations" FontSize="16" FontWeight="SemiBold" 
                                                 Margin="0,0,0,15" Foreground="#2c3e50"/>

                                        <DataGrid x:Name="RoutePerformanceOptimizationGrid" 
                                                AutoGenerateColumns="False" 
                                                CanUserAddRows="False"
                                                CanUserDeleteRows="False"
                                                GridLinesVisibility="Horizontal"
                                                HeadersVisibility="Column"
                                                Background="White"
                                                BorderThickness="1"
                                                BorderBrush="#dee2e6"
                                                MaxHeight="700">

                                            <DataGrid.Columns>
                                                <DataGridTextColumn Header="Priority" Binding="{Binding PriorityIcon}" Width="80"/>
                                                <DataGridTextColumn Header="Route" Binding="{Binding RouteType}" Width="120"/>
                                                <DataGridTextColumn Header="Type" Binding="{Binding RecommendationType}" Width="140"/>
                                                <DataGridTextColumn Header="Title" Binding="{Binding RecommendationTitle}" Width="200"/>
                                                <DataGridTextColumn Header="Potential Savings" Binding="{Binding FormattedPotentialSavings}" Width="140"/>
                                                <DataGridTextColumn Header="Efficiency Gain" Binding="{Binding FormattedEfficiencyImprovement}" Width="140"/>
                                                <DataGridTextColumn Header="Complexity" Binding="{Binding ImplementationComplexity}" Width="120"/>
                                                <DataGridTextColumn Header="Time to Implement" Binding="{Binding TimeToImplement}" Width="140"/>
                                                <DataGridTextColumn Header="Priority Level" Binding="{Binding Priority}" Width="120"/>
                                                <DataGridTextColumn Header="ROI" Binding="{Binding FormattedROI}" Width="100"/>
                                                <DataGridTextColumn Header="Risk Level" Binding="{Binding RiskLevel}" Width="100"/>
                                                <DataGridTextColumn Header="Required Resources" Binding="{Binding RequiredResources}" Width="200"/>
                                                <DataGridTextColumn Header="Description" Binding="{Binding RecommendationDescription}" Width="300"/>
                                            </DataGrid.Columns>
                                        </DataGrid>
                                    </StackPanel>
                                </TabItem>

                                <!-- Profitability Analysis Tab -->
                                <TabItem Header="💹 Profitability">
                                    <StackPanel Margin="20">
                                        <TextBlock Text="Route Profitability Analysis" FontSize="16" FontWeight="SemiBold" 
                                                 Margin="0,0,0,15" Foreground="#2c3e50"/>

                                        <DataGrid x:Name="RoutePerformanceProfitabilityGrid" 
                                                AutoGenerateColumns="False" 
                                                CanUserAddRows="False"
                                                CanUserDeleteRows="False"
                                                GridLinesVisibility="Horizontal"
                                                HeadersVisibility="Column"
                                                Background="White"
                                                BorderThickness="1"
                                                BorderBrush="#dee2e6"
                                                MaxHeight="700">

                                            <DataGrid.Columns>
                                                <DataGridTextColumn Header="Rank" Binding="{Binding ProfitabilityRank}" Width="60"/>
                                                <DataGridTextColumn Header="Route" Binding="{Binding RouteType}" Width="180"/>
                                                <DataGridTextColumn Header="Total Revenue" Binding="{Binding FormattedRevenue}" Width="140"/>
                                                <DataGridTextColumn Header="Total Cost" Binding="{Binding FormattedCost}" Width="140"/>
                                                <DataGridTextColumn Header="Net Profit" Binding="{Binding FormattedNetProfit}" Width="140"/>
                                                <DataGridTextColumn Header="Profit Margin" Binding="{Binding FormattedProfitMargin}" Width="120"/>
                                                <DataGridTextColumn Header="Revenue/Leg" Binding="{Binding FormattedRevenuePerLeg}" Width="120"/>
                                                <DataGridTextColumn Header="Revenue/km" Binding="{Binding RevenuePerKm, StringFormat=C2}" Width="120"/>
                                                <DataGridTextColumn Header="Profit/Leg" Binding="{Binding FormattedProfitPerLeg}" Width="120"/>
                                                <DataGridTextColumn Header="Profit/km" Binding="{Binding ProfitPerKm, StringFormat=C6}" Width="120"/>
                                                <DataGridTextColumn Header="ROI %" Binding="{Binding ROIPercent, StringFormat=N2}" Width="100"/>
                                                <DataGridTextColumn Header="Payback (Months)" Binding="{Binding PaybackPeriodMonths, StringFormat=N1}" Width="140"/>
                                                <DataGridTextColumn Header="Trend" Binding="{Binding ProfitabilityTrend}" Width="120"/>
                                                <DataGridTextColumn Header="Break-even Legs" Binding="{Binding BreakEvenLegsRequired, StringFormat=N1}" Width="140"/>
                                            </DataGrid.Columns>
                                        </DataGrid>
                                    </StackPanel>
                                </TabItem>

                            </TabControl>
                        </Grid>
                    </ScrollViewer>
                </TabItem>

                <!-- More tabs will be added here -->
            </TabControl>
        </Grid>
    </ScrollViewer>
</UserControl>