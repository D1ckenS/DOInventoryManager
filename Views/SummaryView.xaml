<UserControl x:Class="DOInventoryManager.Views.SummaryView"
             xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
             xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml">

    <ScrollViewer VerticalScrollBarVisibility="Auto">
        <Grid Margin="20">
            <Grid.RowDefinitions>
                <RowDefinition Height="Auto"/>
                <!-- Header -->
                <RowDefinition Height="Auto"/>
                <!-- Controls -->
                <RowDefinition Height="*"/>
                <!-- Content -->
            </Grid.RowDefinitions>

            <!-- Header -->
            <StackPanel Grid.Row="0" Orientation="Horizontal" Margin="0,0,0,20">
                <TextBlock Text="📈" FontSize="32" VerticalAlignment="Center" Margin="0,0,10,0"/>
                <TextBlock Text="Monthly Summary Reports" FontSize="28" FontWeight="Bold" 
                         VerticalAlignment="Center" Foreground="{DynamicResource TextPrimaryBrush}"/>
            </StackPanel>

            <!-- Controls -->
            <Border Grid.Row="1" Background="{DynamicResource SubtleBackgroundBrush}" BorderBrush="{DynamicResource BorderSubtleBrush}" BorderThickness="1" 
                  CornerRadius="8" Padding="20" Margin="0,0,0,20">
                <Grid>
                    <Grid.ColumnDefinitions>
                        <ColumnDefinition Width="*"/>
                        <ColumnDefinition Width="Auto"/>
                    </Grid.ColumnDefinitions>

                    <StackPanel Grid.Column="0" Orientation="Horizontal">
                        <TextBlock Text="Select Month:" FontWeight="SemiBold" VerticalAlignment="Center" Margin="0,0,10,0"/>
                        <ComboBox x:Name="MonthComboBox" MinWidth="120" Padding="10,8" 
                                SelectionChanged="MonthComboBox_SelectionChanged"/>
                        <Button x:Name="GenerateBtn" Content="📊 Generate Report" 
                              Background="#007bff" Foreground="White" BorderThickness="0" 
                              Padding="15,10" Margin="15,0,0,0" FontWeight="SemiBold"
                              Click="Generate_Click"/>
                    </StackPanel>

                    <StackPanel Grid.Column="1" Orientation="Horizontal">
                        <Button x:Name="ExportBtn" Content="📤 Export to Excel" 
                              Background="#28a745" Foreground="White" BorderThickness="0" 
                              Padding="15,10" Margin="0,0,10,0" FontWeight="SemiBold"
                              Click="Export_Click"/>
                        <Button x:Name="PrintBtn" Content="🖨️ Print Report" 
                              Background="#6c757d" Foreground="White" BorderThickness="0" 
                              Padding="15,10" FontWeight="SemiBold"
                              Click="Print_Click"/>
                    </StackPanel>
                </Grid>
            </Border>

            <!-- Summary Content -->
            <TabControl Grid.Row="2" x:Name="SummaryTabControl">

                <!-- Executive Summary Tab -->
                <TabItem Header="📊 Executive Summary">
                    <ScrollViewer VerticalScrollBarVisibility="Auto">
                        <StackPanel Margin="20">
                            <!-- KPI Cards -->
                            <Grid Margin="0,0,0,30">
                                <Grid.ColumnDefinitions>
                                    <ColumnDefinition Width="*"/>
                                    <ColumnDefinition Width="*"/>
                                    <ColumnDefinition Width="*"/>
                                    <ColumnDefinition Width="*"/>
                                </Grid.ColumnDefinitions>

                                <Border Grid.Column="0" Background="#007bff" CornerRadius="8" Margin="0,0,15,0" Padding="20">
                                    <StackPanel>
                                        <TextBlock Text="⛽" FontSize="24" HorizontalAlignment="Center" Foreground="White"/>
                                        <TextBlock x:Name="TotalConsumptionText" Text="0 L" FontSize="18" FontWeight="Bold" 
                                                 HorizontalAlignment="Center" Foreground="White" Margin="0,5,0,3"/>
                                        <TextBlock Text="Total Consumption" FontSize="11" HorizontalAlignment="Center" 
                                                 Foreground="LightBlue"/>
                                    </StackPanel>
                                </Border>

                                <Border Grid.Column="1" Background="#28a745" CornerRadius="8" Margin="0,0,15,0" Padding="20">
                                    <StackPanel>
                                        <TextBlock Text="🗺️" FontSize="24" HorizontalAlignment="Center" Foreground="White"/>
                                        <TextBlock x:Name="TotalLegsText" Text="0" FontSize="18" FontWeight="Bold" 
                                                 HorizontalAlignment="Center" Foreground="White" Margin="0,5,0,3"/>
                                        <TextBlock Text="Legs Completed" FontSize="11" HorizontalAlignment="Center" 
                                                 Foreground="LightGreen"/>
                                    </StackPanel>
                                </Border>

                                <Border Grid.Column="2" Background="#dc3545" CornerRadius="8" Margin="0,0,15,0" Padding="20">
                                    <StackPanel>
                                        <TextBlock Text="💰" FontSize="24" HorizontalAlignment="Center" Foreground="White"/>
                                        <TextBlock x:Name="TotalCostText" Text="$0" FontSize="18" FontWeight="Bold" 
                                                 HorizontalAlignment="Center" Foreground="White" Margin="0,5,0,3"/>
                                        <TextBlock Text="Operating Cost" FontSize="11" HorizontalAlignment="Center" 
                                                 Foreground="LightPink"/>
                                    </StackPanel>
                                </Border>

                                <Border Grid.Column="3" Background="#ffc107" CornerRadius="8" Padding="20">
                                    <StackPanel>
                                        <TextBlock Text="📈" FontSize="24" HorizontalAlignment="Center" Foreground="White"/>
                                        <TextBlock x:Name="EfficiencyText" Text="0 L/leg" FontSize="18" FontWeight="Bold" 
                                                 HorizontalAlignment="Center" Foreground="White" Margin="0,5,0,3"/>
                                        <TextBlock Text="Fleet Efficiency" FontSize="11" HorizontalAlignment="Center" 
                                                 Foreground="#856404"/>
                                    </StackPanel>
                                </Border>
                            </Grid>

                            <!-- Executive Metrics -->
                            <Border Background="{DynamicResource CardBackgroundBrush}" BorderBrush="{DynamicResource BorderSubtleBrush}" BorderThickness="1" 
                                  CornerRadius="6" Padding="20" Margin="0,0,0,20">
                                <StackPanel>
                                    <TextBlock Text="📋 Executive Metrics" FontSize="16" FontWeight="SemiBold" 
                                             Margin="0,0,0,15" Foreground="{DynamicResource TextPrimaryBrush}"/>

                                    <Grid>
                                        <Grid.ColumnDefinitions>
                                            <ColumnDefinition Width="*"/>
                                            <ColumnDefinition Width="*"/>
                                        </Grid.ColumnDefinitions>

                                        <StackPanel Grid.Column="0">
                                            <TextBlock x:Name="VesselsOperatedText" Text="Vessels Operated: 0" FontSize="14" Margin="0,5"/>
                                            <TextBlock x:Name="SuppliersUsedText" Text="Suppliers Used: 0" FontSize="14" Margin="0,5"/>
                                            <TextBlock x:Name="CostPerLegText" Text="Cost per Leg: $0.00" FontSize="14" Margin="0,5"/>
                                        </StackPanel>

                                        <StackPanel Grid.Column="1">
                                            <TextBlock x:Name="FleetEfficiencyLText" Text="Fleet Efficiency (L): 0.000 L/leg" FontSize="14" Margin="0,5"/>
                                            <TextBlock x:Name="FleetEfficiencyTText" Text="Fleet Efficiency (T): 0.000 T/leg" FontSize="14" Margin="0,5"/>
                                            <TextBlock x:Name="InventoryTurnoverText" Text="Inventory Turnover: 0.00" FontSize="14" Margin="0,5"/>
                                        </StackPanel>
                                    </Grid>
                                </StackPanel>
                            </Border>
                        </StackPanel>
                    </ScrollViewer>
                </TabItem>

                <!-- Consumption Summary Tab -->
                <TabItem Header="⛽ Consumption Summary">
                    <StackPanel Margin="20">
                        <TextBlock Text="Vessel Consumption Analysis" FontSize="16" FontWeight="SemiBold" 
                                 Margin="0,0,0,15" Foreground="{DynamicResource TextPrimaryBrush}"/>

                        <DataGrid x:Name="ConsumptionSummaryGrid" 
                                AutoGenerateColumns="False" 
                                CanUserAddRows="False"
                                CanUserDeleteRows="False"
                                GridLinesVisibility="Horizontal"
                                HeadersVisibility="Column"
                                BorderThickness="1"
                                BorderBrush="#dee2e6"
                                PreviewMouseWheel="DataGrid_PreviewMouseWheel">

                            <DataGrid.Columns>
                                <DataGridTextColumn Header="Vessel" Binding="{Binding VesselName}" Width="120"/>
                                <DataGridTextColumn Header="Type" Binding="{Binding VesselType}" Width="80"/>
                                <DataGridTextColumn Header="Route" Binding="{Binding Route}" Width="180"/>
                                <DataGridTextColumn Header="Consumption (L)" Binding="{Binding TotalConsumptionL, StringFormat=N3}" Width="120"/>
                                <DataGridTextColumn Header="Consumption (T)" Binding="{Binding TotalConsumptionT, StringFormat=N3}" Width="120"/>
                                <DataGridTextColumn Header="Total Legs" Binding="{Binding TotalLegs}" Width="80"/>
                                <DataGridTextColumn Header="L/Leg" Binding="{Binding AvgConsumptionPerLegL, StringFormat=N3}" Width="80"/>
                                <DataGridTextColumn Header="T/Leg" Binding="{Binding AvgConsumptionPerLegT, StringFormat=N3}" Width="80"/>
                                <DataGridTextColumn Header="Total Cost" Binding="{Binding TotalAllocatedValueUSD, StringFormat=C2}" Width="100"/>
                                <DataGridTextColumn Header="Cost/L" Binding="{Binding CostPerLiter, StringFormat=C6}" Width="100"/>
                                <DataGridTextColumn Header="Cost/T" Binding="{Binding CostPerTon, StringFormat=C2}" Width="100"/>
                                <DataGridTextColumn Header="Entries" Binding="{Binding ConsumptionEntries}" Width="70"/>
                            </DataGrid.Columns>
                        </DataGrid>
                    </StackPanel>
                </TabItem>

                <!-- Purchase Summary Tab -->
                <TabItem Header="🛒 Purchase Summary">
                    <StackPanel Margin="20">
                        <TextBlock Text="Supplier Purchase Analysis" FontSize="16" FontWeight="SemiBold" 
                                 Margin="0,0,0,15" Foreground="{DynamicResource TextPrimaryBrush}"/>

                        <DataGrid x:Name="PurchaseSummaryGrid" 
                                AutoGenerateColumns="False" 
                                CanUserAddRows="False"
                                CanUserDeleteRows="False"
                                GridLinesVisibility="Horizontal"
                                HeadersVisibility="Column"
                                BorderThickness="1"
                                BorderBrush="#dee2e6"
                                PreviewMouseWheel="DataGrid_PreviewMouseWheel">

                            <DataGrid.Columns>
                                <DataGridTextColumn Header="Supplier" Binding="{Binding SupplierName}" Width="120"/>
                                <DataGridTextColumn Header="Currency" Binding="{Binding Currency}" Width="80"/>
                                <DataGridTextColumn Header="Purchases (L)" Binding="{Binding TotalPurchasesL, StringFormat=N3}" Width="110"/>
                                <DataGridTextColumn Header="Purchases (T)" Binding="{Binding TotalPurchasesT, StringFormat=N3}" Width="110"/>
                                <DataGridTextColumn Header="Total Value" Width="120">
                                    <DataGridTextColumn.Binding>
                                        <MultiBinding StringFormat="{}{0:N3} {1}">
                                            <Binding Path="TotalValueOriginal"/>
                                            <Binding Path="Currency"/>
                                        </MultiBinding>
                                    </DataGridTextColumn.Binding>
                                </DataGridTextColumn>
                                <DataGridTextColumn Header="USD Value" Binding="{Binding TotalValueUSD, StringFormat=C2}" Width="100"/>
                                <DataGridTextColumn Header="Avg Price/L" Width="100">
                                    <DataGridTextColumn.Binding>
                                        <MultiBinding StringFormat="{}{0:N6} {1}">
                                            <Binding Path="AvgPricePerLiter"/>
                                            <Binding Path="Currency"/>
                                        </MultiBinding>
                                    </DataGridTextColumn.Binding>
                                </DataGridTextColumn>
                                <DataGridTextColumn Header="Remaining (L)" Binding="{Binding RemainingL, StringFormat=N3}" Width="100"/>
                                <DataGridTextColumn Header="Remaining (T)" Binding="{Binding RemainingT, StringFormat=N3}" Width="100"/>
                                <DataGridTextColumn Header="Orders" Binding="{Binding PurchaseCount}" Width="70"/>
                            </DataGrid.Columns>
                        </DataGrid>
                    </StackPanel>
                </TabItem>

                <!-- Allocation Summary Tab -->
                <TabItem Header="📋 FIFO Allocation">
                    <StackPanel Margin="20">
                        <TextBlock Text="FIFO Allocation Analysis" FontSize="16" FontWeight="SemiBold" 
                                 Margin="0,0,0,15" Foreground="{DynamicResource TextPrimaryBrush}"/>

                        <DataGrid x:Name="AllocationSummaryGrid" 
                                AutoGenerateColumns="False" 
                                CanUserAddRows="False"
                                CanUserDeleteRows="False"
                                GridLinesVisibility="Horizontal"
                                HeadersVisibility="Column"
                                BorderThickness="1"
                                BorderBrush="#dee2e6"
                                PreviewMouseWheel="DataGrid_PreviewMouseWheel">

                            <DataGrid.Columns>
                                <DataGridTextColumn Header="Vessel" Binding="{Binding VesselName}" Width="120"/>
                                <DataGridTextColumn Header="Supplier" Binding="{Binding SupplierName}" Width="120"/>
                                <DataGridTextColumn Header="Allocated (L)" Binding="{Binding AllocatedQuantityL, StringFormat=N3}" Width="110"/>
                                <DataGridTextColumn Header="Allocated (T)" Binding="{Binding AllocatedQuantityT, StringFormat=N3}" Width="110"/>
                                <DataGridTextColumn Header="USD Value" Binding="{Binding AllocatedValueUSD, StringFormat=C2}" Width="100"/>
                                <DataGridTextColumn Header="Allocations" Binding="{Binding AllocationCount}" Width="90"/>
                                <DataGridTextColumn Header="From Date" Binding="{Binding OldestPurchaseDate, StringFormat=dd/MM/yyyy}" Width="100"/>
                                <DataGridTextColumn Header="To Date" Binding="{Binding NewestPurchaseDate, StringFormat=dd/MM/yyyy}" Width="100"/>
                            </DataGrid.Columns>
                        </DataGrid>
                    </StackPanel>
                </TabItem>

                <!-- Financial Summary Tab -->
                <TabItem Header="💰 Financial Summary">
                    <ScrollViewer VerticalScrollBarVisibility="Auto">
                        <StackPanel Margin="20">
                            <!-- Financial Overview -->
                            <Border Background="{DynamicResource CardBackgroundBrush}" BorderBrush="{DynamicResource BorderSubtleBrush}" BorderThickness="1" 
                                  CornerRadius="6" Padding="20" Margin="0,0,0,20">
                                <StackPanel>
                                    <TextBlock Text="💰 Financial Overview" FontSize="16" FontWeight="SemiBold" 
                                             Margin="0,0,0,15" Foreground="{DynamicResource TextPrimaryBrush}"/>

                                    <Grid>
                                        <Grid.ColumnDefinitions>
                                            <ColumnDefinition Width="*"/>
                                            <ColumnDefinition Width="*"/>
                                        </Grid.ColumnDefinitions>

                                        <StackPanel Grid.Column="0">
                                            <TextBlock x:Name="TotalPurchaseValueText" Text="Total Purchases: $0.00" FontSize="14" Margin="0,5"/>
                                            <TextBlock x:Name="TotalConsumptionValueText" Text="Total Consumption: $0.00" FontSize="14" Margin="0,5"/>
                                            <TextBlock x:Name="RemainingInventoryText" Text="Remaining Inventory: $0.00" FontSize="14" Margin="0,5"/>
                                        </StackPanel>

                                        <StackPanel Grid.Column="1">
                                            <TextBlock x:Name="AvgCostPerLiterText" Text="Avg Cost/L: $0.000000" FontSize="14" Margin="0,5"/>
                                            <TextBlock x:Name="AvgCostPerTonText" Text="Avg Cost/T: $0.00" FontSize="14" Margin="0,5"/>
                                        </StackPanel>
                                    </Grid>
                                </StackPanel>
                            </Border>

                            <!-- Currency Breakdown -->
                            <Border Background="{DynamicResource CardBackgroundBrush}" BorderBrush="{DynamicResource BorderSubtleBrush}" BorderThickness="1" 
                                  CornerRadius="6" Padding="20" Margin="0,0,0,20">
                                <StackPanel>
                                    <TextBlock Text="💱 Currency Breakdown" FontSize="16" FontWeight="SemiBold" 
                                             Margin="0,0,0,15" Foreground="{DynamicResource TextPrimaryBrush}"/>

                                    <DataGrid x:Name="CurrencyBreakdownGrid" 
                                            AutoGenerateColumns="False" 
                                            CanUserAddRows="False"
                                            CanUserDeleteRows="False"
                                            GridLinesVisibility="Horizontal"
                                            HeadersVisibility="Column"
                                                        BorderThickness="0">

                                        <DataGrid.Columns>
                                            <DataGridTextColumn Header="Currency" Binding="{Binding Currency}" Width="100"/>
                                            <DataGridTextColumn Header="Total Value" Binding="{Binding TotalValue, StringFormat=N3}" Width="150"/>
                                            <DataGridTextColumn Header="USD Value" Binding="{Binding TotalValueUSD, StringFormat=C2}" Width="150"/>
                                            <DataGridTextColumn Header="Exchange Rate" Binding="{Binding ExchangeRate, StringFormat=N6}" Width="150"/>
                                        </DataGrid.Columns>
                                    </DataGrid>
                                </StackPanel>
                            </Border>

                            <!-- Payment Status -->
                            <Border Background="{DynamicResource CardBackgroundBrush}" BorderBrush="{DynamicResource BorderSubtleBrush}" BorderThickness="1" 
                                  CornerRadius="6" Padding="20">
                                <StackPanel>
                                    <TextBlock Text="📋 Payment Status" FontSize="16" FontWeight="SemiBold" 
                                             Margin="0,0,0,15" Foreground="{DynamicResource TextPrimaryBrush}"/>

                                    <DataGrid x:Name="PaymentStatusGrid" 
                                            AutoGenerateColumns="False" 
                                            CanUserAddRows="False"
                                            CanUserDeleteRows="False"
                                            GridLinesVisibility="Horizontal"
                                            HeadersVisibility="Column"
                                                        BorderThickness="0">

                                        <DataGrid.Columns>
                                            <DataGridTextColumn Header="Supplier" Binding="{Binding SupplierName}" Width="150"/>
                                            <DataGridTextColumn Header="Total Due" Binding="{Binding TotalDue, StringFormat=C2}" Width="120"/>
                                            <DataGridTextColumn Header="Overdue" Binding="{Binding TotalOverdue, StringFormat=C2}" Width="120"/>
                                            <DataGridTextColumn Header="Overdue Count" Binding="{Binding OverdueCount}" Width="120"/>
                                            <DataGridTextColumn Header="Total Invoices" Binding="{Binding TotalInvoices}" Width="120"/>
                                        </DataGrid.Columns>
                                    </DataGrid>
                                </StackPanel>
                            </Border>
                        </StackPanel>
                    </ScrollViewer>
                </TabItem>
            </TabControl>
        </Grid>
    </ScrollViewer>
</UserControl>